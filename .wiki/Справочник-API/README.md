# Справочник API

Этот раздел содержит подробную документацию по всем API интерфейсам и компонентам benadis-runner.

## Структура API

### [API конфигурации](API-конфигурации.md)
Интерфейсы для работы с системой конфигурации, загрузкой настроек и управлением параметрами приложения.

### [Константы и перечисления](Константы-и-перечисления.md)
Определения всех констант, перечислений и фиксированных значений, используемых в приложении.

### [API логики приложения](API-логики-приложения/README.md)
Основные функции для выполнения бизнес-логики:
- [Функция ExecuteDbRestore](API-логики-приложения/ExecuteDbRestore.md)
- [Функция ExecuteEpf](API-логики-приложения/ExecuteEpf.md)
- [Функция ServiceModeEnable](API-логики-приложения/ServiceModeEnable.md)
- [Функция ConvertConfig](API-логики-приложения/ConvertConfig.md)
- [Функция BuildActionMenu](API-логики-приложения/BuildActionMenu.md)

### [Интерфейсы модуля Entity](Интерфейсы-модуля-Entity.md)
Интерфейсы для работы с сущностями системы: базы данных, конфигурации, интеграции с внешними системами.

## Принципы проектирования API

### Консистентность
Все API следуют единым принципам:
- Единообразное именование функций и параметров
- Консистентная обработка ошибок
- Стандартизированные форматы ответов

### Типобезопасность
- Использование строгой типизации Go
- Валидация входных параметров
- Четкие определения структур данных

### Обработка ошибок
- Все функции возвращают error как последний параметр
- Структурированные сообщения об ошибках
- Контекстная информация для диагностики

## Соглашения по именованию

### Функции
- Используется CamelCase с заглавной буквы для экспортируемых функций
- Глаголы в начале имени функции (Get, Set, Create, Delete, Execute)
- Описательные имена, отражающие назначение функции

### Структуры
- CamelCase с заглавной буквы
- Суффиксы для указания типа (Config, Client, Service, Handler)

### Интерфейсы
- CamelCase с заглавной буквы
- Суффикс -er для интерфейсов действий (Logger, Runner, Connector)

## Примеры использования API

### Инициализация конфигурации
```go
import "github.com/your-org/benadis-runner/internal/config"

cfg, err := config.MustLoad()
if err != nil {
    log.Fatal("Ошибка загрузки конфигурации:", err)
}
```

### Выполнение операций с базой данных
```go
import "github.com/your-org/benadis-runner/internal/app"

err := app.ExecuteDbRestore(ctx, logger, cfg, "MyDatabase")
if err != nil {
    log.Printf("Ошибка восстановления БД: %v", err)
}
```

### Управление сервисным режимом
```go
err := app.ServiceModeEnable(ctx, logger, cfg, "MyInfobase", true)
if err != nil {
    log.Printf("Ошибка включения сервисного режима: %v", err)
}
```

## Контекст и отмена операций

Все долговременные операции поддерживают context.Context для:
- Отмены операций по таймауту
- Graceful shutdown приложения
- Передачи метаданных между компонентами

```go
ctx, cancel := context.WithTimeout(context.Background(), 30*time.Minute)
defer cancel()

err := app.ExecuteDbRestore(ctx, logger, cfg, dbname)
```

## Логирование и мониторинг

### Структурированное логирование
Все API функции поддерживают структурированное логирование:

```go
logger.Info("Операция начата",
    "operation", "database_restore",
    "database", dbname,
    "timeout", timeout)
```

### Метрики
API предоставляет метрики для мониторинга:
- Время выполнения операций
- Количество успешных/неудачных операций
- Использование ресурсов

## Расширяемость

### Добавление новых API
При добавлении новых API функций:

1. Определите интерфейс в соответствующем пакете
2. Реализуйте интерфейс в конкретном типе
3. Добавьте валидацию параметров
4. Обеспечьте обработку ошибок
5. Добавьте тесты
6. Обновите документацию

### Версионирование
- API использует семантическое версионирование
- Обратная совместимость поддерживается в рамках мажорной версии
- Устаревшие функции помечаются как deprecated

## Тестирование API

### Юнит тесты
Все API функции покрыты юнит тестами:

```go
func TestExecuteDbRestore(t *testing.T) {
    cfg := &config.Config{
        // тестовая конфигурация
    }
    
    err := app.ExecuteDbRestore(context.Background(), testLogger, cfg, "testdb")
    assert.NoError(t, err)
}
```

### Интеграционные тесты
Интеграционные тесты проверяют взаимодействие между компонентами:

```go
func TestFullRestoreWorkflow(t *testing.T) {
    // Настройка тестового окружения
    // Выполнение полного сценария
    // Проверка результатов
}
```

### Моки и заглушки
Для изоляции тестов используются моки внешних зависимостей:

```go
type MockDBClient struct {
    mock.Mock
}

func (m *MockDBClient) Restore(dbname string) error {
    args := m.Called(dbname)
    return args.Error(0)
}
```