# Задача
Расширить существующий проект на Go новым функционалом.

## Требования
- В проект необходимо добавить новые команды:
- 1. Команда создания нового проекта в SonarQube (sq-project-create)
  - должна работать через SonarQube API
  - параметры для функции создания проекта:
    - URL SonarQube (получается из app.yaml)
    - токен аутентификации SonarQube (получается из secret.yaml)
    - Имя проекта (<owner>_<repo>)
    - набор тегов (разделенные запятой) (<owner>,<repo>,<branch>)
    - описание проекта (содержимое README.md)
    - список администрирующих пользователей (разделенные запятой) (пользователи группы <owner>,<dev>)
    - применяемые правила (получается из app.yaml)
- 2. Команда получения списка проектов в SonarQube (sq-project-list)
  - должна работать через SonarQube API
  - параметры для функции получения списка проектов:
    - URL SonarQube (получается из app.yaml)
    - токен аутентификации SonarQube (получается из secret.yaml)
- 3. Команда сканирования состояния репозитория и отправку результатов в SonarQube (sq-project-scan)
  - должна запускаться локально используя `sonar-scanner` который скачивается из репозитория gitea и запускается с параметрами:
  - параметры для функции сканирования состояния репозитория:
    - URL SonarQube (получается из app.yaml)
    - URL репозитория `sonar-scanner
    - URL репозитория с данными для сканирования
    - путь к файлу конфигурации SonarQube
    - хеш коммита для сканирования
    - ключ проекта SonarQube
- 4. Команда получения списка сканирований проекта в SonarQube (sq-project-scan-list)
  - должна работать через SonarQube API
  - параметры для функции получения списка сканирований проекта:
    - URL SonarQube (получается из app.yaml)
    - токен аутентификации SonarQube (получается из secret.yaml)
    - ключ проекта SonarQube

## Ограничения и рекомендации
- разместить основную логику сканирования в отдельном файле (internal/entity/sonarqube)
- Максимально использовать уже существующие функции и общий стиль кода проекта.
- Поддерживать единообразие с другими командами и функциями в проекте.
- Реализовать решение так, чтобы оно легко расширялось и сопровождалось.
- При разработке каждой функции учитывать следующие аспекты:
  - Читаемость и поддерживаемость кода
  - Эффективность использования ресурсов
  - Удобство использования для других разработчиков
  - Там где это возможно используй при проектировании концепцию SOLID
  - При проектировании каждой функции учитывай принцип единственной ответственности (SRP)
  - При проектировании каждой функции учитывай принцип открытости/закрытости (OCP)
  - При проектировании каждой функции учитывай принцип подстановки Барбары Лисков (LSP)
  - При проектировании каждой функции учитывай принцип разделения интерфейса (ISP)
  - При проектировании каждой функции учитывай принцип инверсии зависимостей (DIP)

  
## Вопросы для уточнения требований

1. **Цели и ожидаемые результаты реализации:**
   - Какова основная цель интеграции с SonarQube в контексте этого проекта?
   - Ответ: Основная цель - автоматизировать процесс анализа качества кода и обеспечить непрерывный мониторинг метрик в процессе разработки, чтобы повысить общее качество кодовой базы и ускорить выявление проблем.
   - Какие метрики качества кода наиболее важны для мониторинга?
   - Ответ: предоставить командам разработчиков инструменты для самостоятельной проверки качества кода перед интеграцией изменений
   - Какие ожидания по частоте использования каждой из новых команд?
   - Ответ: sq-project-create: редко (при создании новых проектов), sq-project-list: периодически (для аудита), sq-project-scan: часто (в CI/CD), sq-project-scan-list: периодически (для мониторинга сканирований)

2. **Ограничения и возможные риски:**
   - Есть ли ограничения по времени выполнения команд?
   - Ответ: Время выполнения может варьироваться в зависимости от размера проекта и загрузки системы
   - Какие ограничения по доступу к SonarQube API существуют?
   - Ответ: Доступ к SonarQube API ограничен пользователями с соответствующими правами.
   - Какие риски безопасности нужно учитывать при работе с токенами?
   - Ответ: Токены должны храниться в файле secret.yaml, предполагается использование его шифрования с использованием sops и age.

3. **Приоритеты реализации функций:**
   - Какие команды имеют наивысший приоритет для реализации?
   - Ответ: Высший приоритет: sq-project-create и sq-project-scan (базовая функциональность), Средний: sq-project-list, Низший: sq-project-scan-list.
   - Можно ли реализовывать функции параллельно или нужно следовать строгой последовательности?
   - Ответ: Можно реализовывать параллельно, но с учетом зависимостей (например, sq-project-scan требует существующего проекта).

4. **Ключевые метрики успеха:**
   - Какие критерии будут использоваться для оценки успешности реализации?
   - Ответ: Успешность измеряется: корректной работой всех команд, интеграцией с CI/CD, соответствием требованиям безопасности, производительностью.
   - Как будет измеряться производительность новых команд?
   - Ответ:  Производительность измеряется временем выполнения команд, потреблением ресурсов, количеством ошибок и таймаутов.
   - Какие тесты необходимо реализовать для проверки корректности работы?
   - Ответ: Необходимо реализовать unit-тесты для каждой команды, интеграционные тесты с реальным SonarQube, тесты на обработку ошибок.

5. **Противоречия и неоднозначности в требованиях:**
   - Требование указывает, что ключ проекта генерируется на стороне SonarQube, но также упоминается в параметрах сканирования. Как обеспечить корректную передачу этого параметра?
   - Ответ: Нужно добавить функцию которая используя SonarQube API получает ключ проекта по его имени. Концепция реализации: curl -u your_token: "http://your-sonarqube-url/api/projects/search?q=projectName" | jq -r '.projects[0].key'. Не используй при реализации данный пример, используй встроенные средства go для работы с http запросами!
   - В требованиях к команде сканирования упомянуты параметры для функции, но не указан формат их передачи в sonar-scanner. Нужно ли реализовать специальную обработку этих параметров?
   - Ответ: Да, необходимо реализовать специальную обработку параметров с формированием корректной командной строки для sonar-scanner.
   - Уточнить, что именно подразумевается под "применяемыми правилами" в контексте создания проекта в SonarQube?
   - Ответ: Подразумеваются quality profiles (наборы правил анализа) для соответствующих языков программирования, которые будут применяться к проекту.

6. **Дополнительные вопросы:**
   - Нужно ли реализовать механизм кэширования для уменьшения количества запросов к API SonarQube?
   - Ответ: нет, не используй кэширование. SonarQube API не поддерживает кэширование, так что нет необходимости в реализации отдельного механизма кэширования.
   - Какие форматы вывода данных предпочтительны для команд, возвращающих списки?
   - Ответ: JSON для автоматического разбора программой.
   - Нужно ли реализовать механизм повторных попыток при временных сбоях API?
   - Ответ: Да, необходимо реализовать механизм повторных попыток с экспоненциальной задержкой для всех API вызовов.
