# Финальный план доводки интеграции SonarQube

## 1. Краткая сводка

### Цель доводки
Завершить реализацию интеграции SonarQube в проекте benadis-runner, обеспечив полный цикл работы с анализом качества кода: создание проектов, сканирование веток и pull request'ов, синхронизацию репозиториев, генерацию отчетов и управление жизненным циклом проектов в SonarQube.

### Область охвата (модули/пакеты)
- `internal/entity/sonarqube/` - низкоуровневое взаимодействие с SonarQube API и sonar-scanner
- `internal/service/sonarqube/` - бизнес-логика и оркестрация операций SonarQube
- `internal/config/` - конфигурация SonarQube и scanner'а

### Критерии готовности релиза (Definition of Done)
- Все функции реализованы в соответствии с требованиями
- Написаны и проходят unit-тесты (покрытие кода не менее 80%)
- Написаны и проходят интеграционные тесты
- Написаны и проходят end-to-end тесты
- Реализована обработка ошибок и логирование
- Документация обновлена и актуальна
- Проект проходит все проверки линтеров
- Все команды SonarQube работают корректно

## 2. Матрица трассируемости

| REQ-ID | TASK-ID | DESIGN-REF | CODE-LOCATIONS | СТАТУС | ПРОБЕЛЫ |
|--------|---------|------------|----------------|--------|---------|
| REQ-1 | TASK-1, TASK-4.1, TASK-4.2, TASK-6.3 | DESIGN-1, DESIGN-4 | internal/service/sonarqube/branch.go:66-156 | Частично | Не реализовано определение первого коммита ветки, базовое сканирование, инкрементальное сканирование |
| REQ-2 | TASK-5.1, TASK-5.2 | DESIGN-1, DESIGN-5 | internal/service/sonarqube/pr.go:49-71 | Не реализовано | Не реализовано получение данных PR из Gitea API, извлечение информации о ветке источника |
| REQ-3 | TASK-6.1 | DESIGN-1, DESIGN-6 | internal/service/sonarqube/project.go:49-71 | Не реализовано | Не реализована синхронизация метаданных проекта с README.md, синхронизация администраторов |
| REQ-4 | TASK-6.2 | DESIGN-1, DESIGN-6 | internal/service/sonarqube/project.go:73-94 | Не реализовано | Не реализовано перечисление веток, сопоставление проектов, вызов sq-project-update/sq-scan-branch |
| REQ-5 | TASK-6.3 | DESIGN-1, DESIGN-6 | internal/service/sonarqube/project.go:96-117 | Не реализовано | Не реализована проверка возраста проектов, удаление устаревших проектов |
| REQ-6 | TASK-7.2 | DESIGN-1, DESIGN-7 | internal/service/sonarqube/reporting.go:66-87 | Не реализовано | Не реализовано получение данных PR, определение ветки источника, вызов sq-report-branch |
| REQ-7 | TASK-7.1 | DESIGN-1, DESIGN-7 | internal/service/sonarqube/reporting.go:42-64 | Не реализовано | Не реализовано получение ошибок между коммитами, форматирование отчета в JSON |
| REQ-8 | TASK-7.3 | DESIGN-1, DESIGN-7 | internal/service/sonarqube/reporting.go:89-111 | Не реализовано | Не реализовано получение данных о всех ветках, определение коммитов, вызов sq-report-branch |
| REQ-9 | TASK-9.1, TASK-9.2, TASK-9.3 | DESIGN-8, DESIGN-9 | internal/entity/sonarqube/sonarqube.go:219-227, internal/service/sonarqube/error_handling.go:46-93, internal/service/sonarqube/logging.go:79-149 | Частично | Не реализован механизм circuit breaker, не все ошибки API обрабатываются корректно |
| REQ-10 | TASK-3.1, TASK-3.2, TASK-3.3 | DESIGN-1, DESIGN-3 | internal/entity/sonarqube/scanner.go:75-134, internal/service/sonarqube/scanner.go:48-72 | Частично | Не реализована загрузка scanner'а из Gitea, не все параметры конфигурации передаются корректно |
| REQ-11 | TASK-11.1, TASK-11.2, TASK-11.3, TASK-12.1, TASK-12.2, TASK-13.1 | DESIGN-10, DESIGN-1, DESIGN-12 | Весь проект | Частично | Не все тесты написаны, не все метрики собираются, документация не завершена |
| REQ-12 | Все TASK-ID | DESIGN-9, DESIGN-10 | Весь проект | Частично | Не все компоненты следуют принципам SOLID, есть дублирование кода |

## 3. Индекс незавершенных участков кода

| КОД | МЕТКА | КОНТЕКСТ | ССЫЛКИ | РИСК/ВЛИЯНИЕ |
|-----|-------|----------|--------|--------------|
| internal/entity/sonarqube/scanner.go:465-473 | ToDo | Необходимо реализовать дополнительный функционал для scanner.go | tasks.md: 3.1, requirements.md: 10.1, 10.2, 9.4 | Ошибки в работе scanner'а, проблемы с качеством анализа кода |
| internal/entity/sonarqube/sonarqube.go:645-651 | ToDo | Необходимо реализовать дополнительный функционал для sonarqube.go | tasks.md: 2.1, 2.2, requirements.md: 1.1, 3.1, 3.2, 9.1, 9.2 | Ошибки API, проблемы с управлением проектами |
| internal/service/sonarqube/branch.go:158-167 | ToDo | Необходимо реализовать дополнительный функционал для branch.go | tasks.md: 4.1, requirements.md: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6 | Ошибки сканирования веток, некорректный анализ кода |
| internal/service/sonarqube/command_handler.go:218-226 | ToDo | Необходимо реализовать дополнительный функционал для command_handler.go | tasks.md: 8.1, requirements.md: 9.1, 9.3 | Ошибки обработки команд, проблемы с координацией сервисов |
| internal/service/sonarqube/config.go:229-236 | ToDo | Необходимо реализовать дополнительный функционал для config.go | tasks.md: 10.1, 10.2, requirements.md: 9.2, 9.3 | Ошибки конфигурации, проблемы с безопасностью |
| internal/service/sonarqube/documentation.go:243-251 | ToDo | Необходимо реализовать дополнительный функционал для documentation.go | tasks.md: 13.1, requirements.md: 11, 12 | Отсутствие документации, проблемы с сопровождением |
| internal/service/sonarqube/error_handling.go:147-155 | ToDo | Необходимо реализовать дополнительный функционал для error_handling.go | tasks.md: 9.1, 9.3, requirements.md: 9.1, 9.3, 9.4 | Ошибки обработки исключений, проблемы с отказоустойчивостью |
| internal/service/sonarqube/logging.go:151-158 | ToDo | Необходимо реализовать дополнительный функционал для logging.go | tasks.md: 9.2, requirements.md: 9.1 | Проблемы с отладкой, недостаточная диагностика |
| internal/service/sonarqube/monitoring.go:214-225 | ToDo | Необходимо реализовать дополнительный функционал для monitoring.go | tasks.md: 12.1, 12.2, requirements.md: 11, 12 | Отсутствие мониторинга, проблемы с производительностью |
| internal/service/sonarqube/pr.go:73-82 | ToDo | Необходимо реализовать дополнительный функционал для pr.go | tasks.md: 5.1, requirements.md: 2.1, 2.2, 2.3 | Ошибки сканирования PR, некорректный анализ изменений |
| internal/service/sonarqube/project.go:119-129 | ToDo | Необходимо реализовать дополнительный функционал для project.go | tasks.md: 6.1, 6.2, 6.3, requirements.md: 3.1, 3.2, 3.3, 4.1, 4.2, 4.3, 4.4, 5.1, 5.2, 5.3, 5.4, 5.5 | Ошибки управления проектами, проблемы с синхронизацией |
| internal/service/sonarqube/reporting.go:113-125 | ToDo | Необходимо реализовать дополнительный функционал для reporting.go | tasks.md: 7.1, 7.2, 7.3, requirements.md: 7.1, 7.2, 8.1, 8.2, 8.3, 8.4 | Ошибки генерации отчетов, проблемы с анализом качества |
| internal/service/sonarqube/scanner.go:197-205 | ToDo | Необходимо реализовать дополнительный функционал для scanner.go | tasks.md: 3.3, requirements.md: 10.1, 10.2, 10.3 | Ошибки сканирования, проблемы с качеством анализа кода |
| internal/service/sonarqube/service.go:439-448 | ToDo | Необходимо реализовать дополнительный функционал для service.go | tasks.md: 2.3, requirements.md: 3.1, 3.2, 9.1 | Ошибки кэширования, проблемы с производительностью |
| internal/service/sonarqube/testing.go:112-122 | ToDo | Необходимо реализовать дополнительный функционал для testing.go | tasks.md: 11.1, 11.2, 11.3, requirements.md: 11, 12 | Недостаточное тестовое покрытие, проблемы с качеством кода |

## 4. Детальный план реализации (по шагам)

### TASK-4.2: Реализация логики обработки коммитов

**Связанные требования:** REQ-1
**Связанные пункты плана:** TASK-4.2 (из tasks.md)
**Связанные разделы дизайна:** DESIGN-1, DESIGN-4
**Точки входа в код:** internal/service/sonarqube/branch.go:66-156
**Что нужно изменить/добавить:** 
- Реализовать определение первого коммита для не-main веток
- Добавить логику сканирования базового коммита
- Реализовать инкрементальное сканирование для изменений в ветке
- Добавить методы для работы с коммитами в Gitea API

**Граничные случаи/ошибки:**
- Ветка не существует в репозитории
- Нет доступа к репозиторию
- Невозможно определить первый коммит
- Ошибка при сканировании базового коммита

**Безопасность и доступы:**
- Проверка прав доступа к репозиторию
- Валидация токена доступа к Gitea API

**Производительность и ресурсы:**
- Оптимизация запросов к Gitea API
- Кэширование информации о коммитах
- Ограничение количества параллельных операций сканирования

**Зависимости от других задач:**
- TASK-4.1 (реализация обработчика sq-scan-branch)
- TASK-2.2 (реализация методов SonarQube API)

**Миграции и обратная совместимость:**
- Нет breaking изменений
- Добавляются новые функции без изменения существующего API

**Тесты:**
- Unit-тесты для методов определения коммитов
- Unit-тесты для логики сканирования
- Интеграционные тесты с Gitea API
- Интеграционные тесты с SonarQube API
- E2E тесты для команды sq-scan-branch

**Артефакты/документация:**
- Обновить комментарии в internal/service/sonarqube/branch.go
- Добавить примеры использования в документацию
- Обновить API документацию

**Определение готовности (DoD):**
- [ ] Реализована логика определения первого коммита
- [ ] Реализована логика сканирования базового коммита
- [ ] Реализована логика инкрементального сканирования
- [ ] Написаны unit-тесты (покрытие не менее 80%)
- [ ] Написаны интеграционные тесты
- [ ] Написаны E2E тесты
- [ ] Обновлена документация
- [ ] Пройдены все проверки линтеров
- [ ] Пройдены все тесты в CI/CD

**Критерии приёмки:**
1. WHEN пользователь выполняет команду sq-scan-branch для не-main ветки без commit_hash THEN система определяет первый коммит ветки
2. WHEN система определяет первый коммит THEN система сканирует базовый коммит при необходимости
3. WHEN система сканирует ветку THEN система использует инкрементальное сканирование для изменений

### TASK-4.3: Интеграция выполнения сканера с сканированием веток

**Связанные требования:** REQ-1, REQ-10
**Связанные пункты плана:** TASK-4.3 (из tasks.md)
**Связанные разделы дизайна:** DESIGN-1, DESIGN-3, DESIGN-4
**Точки входа в код:** internal/service/sonarqube/branch.go:66-156, internal/service/sonarqube/scanner.go:48-72
**Что нужно изменить/добавить:**
- Подключить сервис сканера к обработчику сканирования веток
- Добавить конфигурацию сканера на основе данных ветки и коммита
- Реализовать обработку результатов сканирования и ошибок
- Добавить логирование процесса сканирования

**Граничные случаи/ошибки:**
- Ошибка загрузки сканера
- Ошибка конфигурации сканера
- Ошибка выполнения сканера
- Таймаут выполнения сканера
- Недостаточно ресурсов для выполнения сканера

**Безопасность и доступы:**
- Проверка прав доступа к репозиторию
- Валидация токена доступа к SonarQube
- Защита от выполнения сканера с вредоносными параметрами

**Производительность и ресурсы:**
- Оптимизация использования ресурсов при выполнении сканера
- Ограничение количества параллельных операций сканирования
- Мониторинг использования ресурсов

**Зависимости от других задач:**
- TASK-3.3 (реализация сервиса сканера)
- TASK-4.2 (реализация логики обработки коммитов)

**Миграции и обратная совместимость:**
- Нет breaking изменений
- Добавляются новые функции без изменения существующего API

**Тесты:**
- Unit-тесты для интеграции сервисов
- Интеграционные тесты полного потока сканирования веток
- Тесты обработки ошибок сканера
- Тесты таймаутов и ограничений ресурсов

**Артефакты/документация:**
- Обновить комментарии в internal/service/sonarqube/branch.go
- Обновить комментарии в internal/service/sonarqube/scanner.go
- Добавить примеры использования в документацию
- Обновить API документацию

**Определение готовности (DoD):**
- [ ] Подключен сервис сканера к обработчику сканирования веток
- [ ] Реализована конфигурация сканера на основе данных ветки и коммита
- [ ] Реализована обработка результатов сканирования и ошибок
- [ ] Написаны unit-тесты (покрытие не менее 80%)
- [ ] Написаны интеграционные тесты
- [ ] Обновлена документация
- [ ] Пройдены все проверки линтеров
- [ ] Пройдены все тесты в CI/CD

**Критерии приёмки:**
1. WHEN система сканирует ветку THEN система конфигурирует сканер с правильными параметрами
2. WHEN сканер выполняется THEN система обрабатывает результаты сканирования
3. WHEN сканер возвращает ошибку THEN система корректно обрабатывает ошибку и логирует её

### TASK-5.2: Интеграция сканирования PR с сканированием веток

**Связанные требования:** REQ-2
**Связанные пункты плана:** TASK-5.2 (из tasks.md)
**Связанные разделы дизайна:** DESIGN-1, DESIGN-5
**Точки входа в код:** internal/service/sonarqube/pr.go:49-71, internal/service/sonarqube/branch.go:66-156
**Что нужно изменить/добавить:**
- Подключить обработчик SQScanPR к обработчику SQScanBranch
- Реализовать извлечение параметров сканирования из данных PR
- Добавить обработку результатов сканирования PR
- Добавить специфичные параметры сканирования для PR

**Граничные случаи/ошибки:**
- PR не существует
- Нет доступа к PR
- Ошибка извлечения данных PR
- Ошибка при сканировании ветки источника

**Безопасность и доступы:**
- Проверка прав доступа к репозиторию
- Валидация токена доступа к Gitea API
- Защита от выполнения сканирования с вредоносными параметрами

**Производительность и ресурсы:**
- Оптимизация запросов к Gitea API
- Кэширование данных PR
- Ограничение количества параллельных операций сканирования

**Зависимости от других задач:**
- TASK-5.1 (реализация обработчика sq-scan-pr)
- TASK-4.1 (реализация обработчика sq-scan-branch)

**Миграции и обратная совместимость:**
- Нет breaking изменений
- Добавляются новые функции без изменения существующего API

**Тесты:**
- Unit-тесты для интеграции обработчиков
- Интеграционные тесты полного потока сканирования PR
- Тесты обработки ошибок извлечения данных PR
- E2E тесты для команды sq-scan-pr

**Артефакты/документация:**
- Обновить комментарии в internal/service/sonarqube/pr.go
- Обновить комментарии в internal/service/sonarqube/branch.go
- Добавить примеры использования в документацию
- Обновить API документацию

**Определение готовности (DoD):**
- [ ] Подключен обработчик SQScanPR к обработчику SQScanBranch
- [ ] Реализовано извлечение параметров сканирования из данных PR
- [ ] Реализована обработка результатов сканирования PR
- [ ] Написаны unit-тесты (покрытие не менее 80%)
- [ ] Написаны интеграционные тесты
- [ ] Написаны E2E тесты
- [ ] Обновлена документация
- [ ] Пройдены все проверки линтеров
- [ ] Пройдены все тесты в CI/CD

**Критерии приёмки:**
1. WHEN пользователь выполняет команду sq-scan-pr THEN система извлекает данные PR из Gitea API
2. WHEN система извлекает данные PR THEN система извлекает информацию о ветке источника
3. WHEN система определяет ветку источника THEN система вызывает sq-scan-branch для сканирования ветки

### TASK-6.1: Реализация обработчика команды sq-project-update

**Связанные требования:** REQ-3
**Связанные пункты плана:** TASK-6.1 (из tasks.md)
**Связанные разделы дизайна:** DESIGN-1, DESIGN-6
**Точки входа в код:** internal/service/sonarqube/project.go:49-71
**Что нужно изменить/добавить:**
- Реализовать извлечение содержимого README.md из репозитория
- Реализовать обновление описания проекта в SonarQube
- Реализовать синхронизацию списка администраторов с группами owners и dev из репозитория owner/repo Gitea
- Добавить логирование операций обновления проекта

**Граничные случаи/ошибки:**
- README.md не существует в репозитории
- Нет доступа к репозиторию
- Ошибка обновления проекта в SonarQube
- Ошибка синхронизации администраторов

**Безопасность и доступы:**
- Проверка прав доступа к репозиторию
- Валидация токена доступа к Gitea API и SonarQube
- Защита от обновления проекта с вредоносными данными

**Производительность и ресурсы:**
- Оптимизация запросов к Gitea API
- Кэширование данных о проекте
- Ограничение количества параллельных операций обновления

**Зависимости от других задач:**
- TASK-2.2 (реализация методов SonarQube API)
- TASK-8.1 (реализация обработчика команд)

**Миграции и обратная совместимость:**
- Нет breaking изменений
- Добавляются новые функции без изменения существующего API

**Тесты:**
- Unit-тесты для методов обновления проекта
- Интеграционные тесты с Gitea API
- Интеграционные тесты с SonarQube API
- E2E тесты для команды sq-project-update

**Артефакты/документация:**
- Обновить комментарии в internal/service/sonarqube/project.go
- Добавить примеры использования в документацию
- Обновить API документацию

**Определение готовности (DoD):**
- [ ] Реализовано извлечение содержимого README.md из репозитория
- [ ] Реализовано обновление описания проекта в SonarQube
- [ ] Реализована синхронизация списка администраторов
- [ ] Написаны unit-тесты (покрытие не менее 80%)
- [ ] Написаны интеграционные тесты
- [ ] Написаны E2E тесты
- [ ] Обновлена документация
- [ ] Пройдены все проверки линтеров
- [ ] Пройдены все тесты в CI/CD

**Критерии приёмки:**
1. WHEN пользователь выполняет команду sq-project-update THEN система получает содержимое README.md из репозитория
2. WHEN система получает содержимое README.md THEN система обновляет описание проекта в SonarQube
3. WHEN система обновляет проект THEN система синхронизирует список администраторов с группами owners и dev из репозитория owner/repo Gitea

### TASK-6.2: Реализация обработчика команды sq-repo-sync

**Связанные требования:** REQ-4
**Связанные пункты плана:** TASK-6.2 (из tasks.md)
**Связанные разделы дизайна:** DESIGN-1, DESIGN-6
**Точки входа в код:** internal/service/sonarqube/project.go:73-94
**Что нужно изменить/добавить:**
- Реализовать перечисление веток из Gitea API
- Реализовать получение списка проектов из SonarQube API
- Реализовать логику обработки каждой ветки (вызов sq-project-update или sq-scan-branch)
- Реализовать вызов sq-repo-clear для очистки устаревших проектов
- Добавить параллельную обработку веток с использованием goroutines

**Граничные случаи/ошибки:**
- Ошибка получения списка веток из Gitea API
- Ошибка получения списка проектов из SonarQube API
- Ошибка обработки отдельной ветки
- Ошибка вызова sq-repo-clear

**Безопасность и доступы:**
- Проверка прав доступа к репозиторию
- Валидация токена доступа к Gitea API и SonarQube
- Защита от выполнения синхронизации с вредоносными параметрами

**Производительность и ресурсы:**
- Оптимизация запросов к Gitea API и SonarQube API
- Кэширование данных о ветках и проектах
- Ограничение количества параллельных операций синхронизации
- Мониторинг использования ресурсов

**Зависимости от других задач:**
- TASK-6.1 (реализация обработчика sq-project-update)
- TASK-4.1 (реализация обработчика sq-scan-branch)
- TASK-6.3 (реализация обработчика sq-repo-clear)

**Миграции и обратная совместимость:**
- Нет breaking изменений
- Добавляются новые функции без изменения существующего API

**Тесты:**
- Unit-тесты для методов синхронизации репозитория
- Интеграционные тесты с Gitea API
- Интеграционные тесты с SonarQube API
- Тесты параллельной обработки веток
- E2E тесты для команды sq-repo-sync

**Артефакты/документация:**
- Обновить комментарии в internal/service/sonarqube/project.go
- Добавить примеры использования в документацию
- Обновить API документацию

**Определение готовности (DoD):**
- [ ] Реализовано перечисление веток из Gitea API
- [ ] Реализовано получение списка проектов из SonarQube API
- [ ] Реализована логика обработки каждой ветки
- [ ] Реализован вызов sq-repo-clear для очистки устаревших проектов
- [ ] Написаны unit-тесты (покрытие не менее 80%)
- [ ] Написаны интеграционные тесты
- [ ] Написаны E2E тесты
- [ ] Обновлена документация
- [ ] Пройдены все проверки линтеров
- [ ] Пройдены все тесты в CI/CD

**Критерии приёмки:**
1. WHEN пользователь выполняет команду sq-repo-sync THEN система получает список веток из Gitea API
2. WHEN система получает список веток THEN система получает список проектов из SonarQube API
3. FOR каждой ветки IF проект существует THEN система вызывает sq-project-update ELSE система вызывает sq-scan-branch с пустым commit_hash
4. WHEN обработка веток завершена THEN система вызывает sq-repo-clear для очистки устаревших проектов

### TASK-6.3: Реализация обработчика команды sq-repo-clear

**Связанные требования:** REQ-5
**Связанные пункты плана:** TASK-6.3 (из tasks.md)
**Связанные разделы дизайна:** DESIGN-1, DESIGN-6
**Точки входа в код:** internal/service/sonarqube/project.go:96-117
**Что нужно изменить/добавить:**
- Реализовать получение значения sq_wait_for_delete из конфигурации
- Реализовать получение списка веток из Gitea API и списка проектов из SonarQube API
- Реализовать логику удаления проектов (немедленное удаление при force=true или удаление по истечении времени)
- Реализовать вывод сообщения о несоответствии при невозможности удаления проекта
- Добавить логирование операций очистки

**Граничные случаи/ошибки:**
- Ошибка получения конфигурации
- Ошибка получения списка веток из Gitea API
- Ошибка получения списка проектов из SonarQube API
- Ошибка удаления проекта
- Невозможность удаления проекта

**Безопасность и доступы:**
- Проверка прав доступа к репозиторию
- Валидация токена доступа к Gitea API и SonarQube
- Защита от удаления проектов с вредоносными параметрами

**Производительность и ресурсы:**
- Оптимизация запросов к Gitea API и SonarQube API
- Кэширование данных о ветках и проектах
- Ограничение количества параллельных операций удаления
- Мониторинг использования ресурсов

**Зависимости от других задач:**
- TASK-2.2 (реализация методов SonarQube API)

**Миграции и обратная совместимость:**
- Нет breaking изменений
- Добавляются новые функции без изменения существующего API

**Тесты:**
- Unit-тесты для методов очистки репозитория
- Интеграционные тесты с Gitea API
- Интеграционные тесты с SonarQube API
- Тесты различных сценариев удаления проектов
- E2E тесты для команды sq-repo-clear

**Артефакты/документация:**
- Обновить комментарии в internal/service/sonarqube/project.go
- Добавить примеры использования в документацию
- Обновить API документацию

**Определение готовности (DoD):**
- [ ] Реализовано получение значения sq_wait_for_delete из конфигурации
- [ ] Реализовано получение списка веток из Gitea API и списка проектов из SonarQube API
- [ ] Реализована логика удаления проектов
- [ ] Реализован вывод сообщения о несоответствии при невозможности удаления проекта
- [ ] Написаны unit-тесты (покрытие не менее 80%)
- [ ] Написаны интеграционные тесты
- [ ] Написаны E2E тесты
- [ ] Обновлена документация
- [ ] Пройдены все проверки линтеров
- [ ] Пройдены все тесты в CI/CD

**Критерии приёмки:**
1. WHEN пользователь выполняет команду sq-repo-clear THEN система получает значение sq_wait_for_delete из конфигурации
2. WHEN система получает конфигурацию THEN система получает список веток из Gitea API и список проектов из SonarQube API
3. FOR каждого проекта IF проект не соответствует ни одной ветке THEN IF force равен true THEN система удаляет проект немедленно
4. IF force равен false AND время с последнего сканирования больше sq_wait_for_delete THEN система удаляет проект
5. IF проект не может быть удален THEN система выводит сообщение о несоответствии

### TASK-7.1: Реализация обработчика команды sq-report-branch

**Связанные требования:** REQ-7
**Связанные пункты плана:** TASK-7.1 (из tasks.md)
**Связанные разделы дизайна:** DESIGN-1, DESIGN-7
**Точки входа в код:** internal/service/sonarqube/reporting.go:42-64
**Что нужно изменить/добавить:**
- Реализовать получение ошибок между коммитами из SonarQube API
- Реализовать форматирование отчета в формате JSON с детализацией найденных проблем
- Добавить логирование операций генерации отчета
- Добавить обработку ошибок получения данных из API

**Граничные случаи/ошибки:**
- Ошибка получения данных из SonarQube API
- Нет данных для формирования отчета
- Ошибка форматирования отчета
- Неверные параметры команды

**Безопасность и доступы:**
- Проверка прав доступа к репозиторию
- Валидация токена доступа к SonarQube
- Защита от получения данных с вредоносными параметрами

**Производительность и ресурсы:**
- Оптимизация запросов к SonarQube API
- Кэширование данных об ошибках
- Ограничение количества параллельных операций генерации отчетов
- Мониторинг использования ресурсов

**Зависимости от других задач:**
- TASK-2.2 (реализация методов SonarQube API)

**Миграции и обратная совместимость:**
- Нет breaking изменений
- Добавляются новые функции без изменения существующего API

**Тесты:**
- Unit-тесты для методов генерации отчета
- Интеграционные тесты с SonarQube API
- Тесты различных форматов отчетов
- Тесты обработки ошибок
- E2E тесты для команды sq-report-branch

**Артефакты/документация:**
- Обновить комментарии в internal/service/sonarqube/reporting.go
- Добавить примеры использования в документацию
- Обновить API документацию

**Определение готовности (DoD):**
- [ ] Реализовано получение ошибок между коммитами из SonarQube API
- [ ] Реализовано форматирование отчета в формате JSON
- [ ] Написаны unit-тесты (покрытие не менее 80%)
- [ ] Написаны интеграционные тесты
- [ ] Написаны E2E тесты
- [ ] Обновлена документация
- [ ] Пройдены все проверки линтеров
- [ ] Пройдены все тесты в CI/CD

**Критерии приёмки:**
1. WHEN пользователь выполняет команду sq-report-branch THEN система получает ошибки между коммитами из SonarQube API
2. WHEN система получает ошибки THEN система возвращает отчет в формате JSON с детализацией найденных проблем

### TASK-7.2: Реализация обработчика команды sq-report-pr

**Связанные требования:** REQ-6
**Связанные пункты плана:** TASK-7.2 (из tasks.md)
**Связанные разделы дизайна:** DESIGN-1, DESIGN-7
**Точки входа в код:** internal/service/sonarqube/reporting.go:66-87
**Что нужно изменить/добавить:**
- Реализовать получение данных PR из Gitea API
- Реализовать определение ветки источника, первого и последнего коммитов
- Реализовать вызов sq-report-branch для получения отчета по ветке
- Реализовать форматирование отчета по PR и размещение его в задаче репозитория
- Добавить логирование операций генерации отчета

**Граничные случаи/ошибки:**
- Ошибка получения данных PR из Gitea API
- Ошибка определения ветки источника
- Ошибка вызова sq-report-branch
- Ошибка форматирования отчета по PR
- Ошибка размещения отчета в задаче репозитория

**Безопасность и доступы:**
- Проверка прав доступа к репозиторию
- Валидация токена доступа к Gitea API и SonarQube
- Защита от получения данных с вредоносными параметрами

**Производительность и ресурсы:**
- Оптимизация запросов к Gitea API и SonarQube API
- Кэширование данных о PR и ветках
- Ограничение количества параллельных операций генерации отчетов
- Мониторинг использования ресурсов

**Зависимости от других задач:**
- TASK-7.1 (реализация обработчика sq-report-branch)
- TASK-5.1 (реализация обработчика sq-scan-pr)

**Миграции и обратная совместимость:**
- Нет breaking изменений
- Добавляются новые функции без изменения существующего API

**Тесты:**
- Unit-тесты для методов генерации отчета по PR
- Интеграционные тесты с Gitea API
- Интеграционные тесты с SonarQube API
- Тесты различных форматов отчетов
- Тесты обработки ошибок
- E2E тесты для команды sq-report-pr

**Артефакты/документация:**
- Обновить комментарии в internal/service/sonarqube/reporting.go
- Добавить примеры использования в документацию
- Обновить API документацию

**Определение готовности (DoD):**
- [ ] Реализовано получение данных PR из Gitea API
- [ ] Реализовано определение ветки источника, первого и последнего коммитов
- [ ] Реализован вызов sq-report-branch для получения отчета по ветке
- [ ] Реализовано форматирование отчета по PR и размещение его в задаче репозитория
- [ ] Написаны unit-тесты (покрытие не менее 80%)
- [ ] Написаны интеграционные тесты
- [ ] Написаны E2E тесты
- [ ] Обновлена документация
- [ ] Пройдены все проверки линтеров
- [ ] Пройдены все тесты в CI/CD

**Критерии приёмки:**
1. WHEN пользователь выполняет команду sq-report-pr THEN система получает данные PR из Gitea API
2. WHEN система получает данные PR THEN система определяет ветку источника, первый и последний коммиты
3. WHEN система определяет коммиты THEN система вызывает sq-report-branch для получения отчета по ветке
4. WHEN система получает отчет по ветке THEN система формирует отчет по PR и размещает его в задаче репозитория

### TASK-7.3: Реализация обработчика команды sq-report-project

**Связанные требования:** REQ-8
**Связанные пункты плана:** TASK-7.3 (из tasks.md)
**Связанные разделы дизайна:** DESIGN-1, DESIGN-7
**Точки входа в код:** internal/service/sonarqube/reporting.go:89-11
**Что нужно изменить/добавить:**
- Реализовать получение данных о всех ветках из Gitea API
- Реализовать определение коммитов для каждой ветки (второй и последний для main, первый и последний для остальных)
- Реализовать вызов sq-report-branch для получения отчета по каждой ветке
- Реализовать объединение отчетов в сводный отчет по проекту
- Добавить логирование операций генерации отчета

**Граничные случаи/ошибки:**
- Ошибка получения данных о ветках из Gitea API
- Ошибка определения коммитов для ветки
- Ошибка вызова sq-report-branch
- Ошибка объединения отчетов
- Неверные параметры команды

**Безопасность и доступы:**
- Проверка прав доступа к репозиторию
- Валидация токена доступа к Gitea API и SonarQube
- Защита от получения данных с вредоносными параметрами

**Производительность и ресурсы:**
- Оптимизация запросов к Gitea API и SonarQube API
- Кэширование данных о ветках и коммитах
- Ограничение количества параллельных операций генерации отчетов
- Мониторинг использования ресурсов

**Зависимости от других задач:**
- TASK-7.1 (реализация обработчика sq-report-branch)
- TASK-6.2 (реализация обработчика sq-repo-sync)

**Миграции и обратная совместимость:**
- Нет breaking изменений
- Добавляются новые функции без изменения существующего API

**Тесты:**
- Unit-тесты для методов генерации сводного отчета
- Интеграционные тесты с Gitea API
- Интеграционные тесты с SonarQube API
- Тесты различных форматов отчетов
- Тесты обработки ошибок
- E2E тесты для команды sq-report-project

**Артефакты/документация:**
- Обновить комментарии в internal/service/sonarqube/reporting.go
- Добавить примеры использования в документацию
- Обновить API документацию

**Определение готовности (DoD):**
- [ ] Реализовано получение данных о всех ветках из Gitea API
- [ ] Реализовано определение коммитов для каждой ветки
- [ ] Реализован вызов sq-report-branch для получения отчета по каждой ветке
- [ ] Реализовано объединение отчетов в сводный отчет по проекту
- [ ] Написаны unit-тесты (покрытие не менее 80%)
- [ ] Написаны интеграционные тесты
- [ ] Написаны E2E тесты
- [ ] Обновлена документация
- [ ] Пройдены все проверки линтеров
- [ ] Пройдены все тесты в CI/CD

**Критерии приёмки:**
1. WHEN пользователь выполняет команду sq-report-project THEN система получает данные о всех ветках из Gitea API
2. FOR каждой ветки IF ветка является main THEN система получает второй и последний коммиты ELSE система получает первый и последний коммиты
3. FOR каждой ветки WHEN система определяет коммиты THEN система вызывает sq-report-branch для получения отчета по ветке
4. WHEN все отчеты получены THEN система объединяет их в сводный отчет по проекту

### TASK-8.2: Интеграция с существующей структурой app.go

**Связанные требования:** REQ-9, REQ-11
**Связанные пункты плана:** TASK-8.2 (из tasks.md)
**Связанные разделы дизайна:** DESIGN-1, DESIGN-2
**Точки входа в код:** internal/app/app.go, internal/service/sonarqube/command_handler.go
**Что нужно изменить/добавить:**
- Добавить обработчики команд SQ в основное приложение
- Реализовать загрузку конфигурации для настроек SonarQube
- Добавить регистрацию CLI команд следуя существующим паттернам
- Добавить инициализацию всех сервисов SonarQube в приложении
- Добавить корректную обработку ошибок и логирование

**Граничные случаи/ошибки:**
- Ошибка загрузки конфигурации
- Ошибка инициализации сервисов
- Ошибка регистрации команд
- Неверные параметры командной строки

**Безопасность и доступы:**
- Проверка прав доступа к репозиторию
- Валидация токенов доступа
- Защита от выполнения команд с вредоносными параметрами

**Производительность и ресурсы:**
- Оптимизация инициализации сервисов
- Кэширование конфигурации
- Мониторинг использования ресурсов

**Зависимости от других задач:**
- TASK-8.1 (реализация координатора команд)
- TASK-10.2 (реализация интеграции конфигурационных файлов)

**Миграции и обратная совместимость:**
- Нет breaking изменений
- Добавляются новые команды без изменения существующего API

**Тесты:**
- Интеграционные тесты интеграции с app.go
- Тесты загрузки конфигурации
- Тесты регистрации команд
- E2E тесты выполнения команд

**Артефакты/документация:**
- Обновить комментарии в internal/app/app.go
- Добавить примеры использования в документацию
- Обновить API документацию

**Определение готовности (DoD):**
- [ ] Добавлены обработчики команд SQ в основное приложение
- [ ] Реализована загрузка конфигурации для настроек SonarQube
- [ ] Добавлена регистрация CLI команд следуя существующим паттернам
- [ ] Добавлена инициализация всех сервисов SonarQube в приложении
- [ ] Написаны интеграционные тесты
- [ ] Написаны E2E тесты
- [ ] Обновлена документация
- [ ] Пройдены все проверки линтеров
- [ ] Пройдены все тесты в CI/CD

**Критерии приёмки:**
1. WHEN приложение запускается THEN система добавляет обработчики команд SQ в основное приложение
2. WHEN приложение инициализируется THEN система загружает конфигурацию для настроек SonarQube
3. WHEN приложение запускается THEN система регистрирует CLI команды следуя существующим паттернам

### TASK-9.1: Реализация типизированной системы ошибок

**Связанные требования:** REQ-9
**Связанные пункты плана:** TASK-9.1 (из tasks.md)
**Связанные разделы дизайна:** DESIGN-8
**Точки входа в код:** internal/entity/sonarqube/errors.go, internal/service/sonarqube/error_handling.go
**Что нужно изменить/добавить:**
- Создать типы ошибок SonarQubeError, ScannerError и ValidationError
- Добавить обертывание ошибок и сохранение контекста
- Реализовать форматирование пользовательских сообщений об ошибках
- Добавить методы для проверки типов ошибок

**Граничные случаи/ошибки:**
- Ошибка создания типизированной ошибки
- Ошибка обертывания ошибок
- Ошибка форматирования сообщений
- Неправильная классификация ошибок

**Безопасность и доступы:**
- Не выводить чувствительные данные в сообщениях об ошибках
- Валидация данных перед созданием ошибок

**Производительность и ресурсы:**
- Минимизация накладных расходов на создание ошибок
- Эффективное обертывание ошибок

**Зависимости от других задач:**
- Нет

**Миграции и обратная совместимость:**
- Нет breaking изменений
- Добавляются новые типы ошибок без изменения существующего API

**Тесты:**
- Unit-тесты для всех типов ошибок
- Тесты обертывания ошибок
- Тесты форматирования сообщений
- Тесты проверки типов ошибок

**Артефакты/документация:**
- Обновить комментарии в internal/entity/sonarqube/errors.go
- Обновить комментарии в internal/service/sonarqube/error_handling.go
- Добавить примеры использования в документацию

**Определение готовности (DoD):**
- [ ] Созданы типы ошибок SonarQubeError, ScannerError и ValidationError
- [ ] Добавлено обертывание ошибок и сохранение контекста
- [ ] Реализовано форматирование пользовательских сообщений об ошибках
- [ ] Добавлены методы для проверки типов ошибок
- [ ] Написаны unit-тесты (покрытие не менее 80%)
- [ ] Обновлена документация
- [ ] Пройдены все проверки линтеров
- [ ] Пройдены все тесты в CI/CD

**Критерии приёмки:**
1. WHEN происходит ошибка API SonarQube или Gitea THEN система создает ошибку типа SonarQubeError
2. WHEN происходит ошибка sonar-scanner THEN система создает ошибку типа ScannerError
3. WHEN происходит ошибка валидации THEN система создает ошибку типа ValidationError
4. WHEN ошибка обрабатывается THEN система предоставляет пользователю понятное сообщение

### TASK-9.3: Реализация паттернов повтора и circuit breaker

**Связанные требования:** REQ-9
**Связанные пункты плана:** TASK-9.3 (из tasks.md)
**Связанные разделы дизайна:** DESIGN-8
**Точки входа в код:** internal/service/sonarqube/error_handling.go
**Что нужно изменить/добавить:**
- Добавить механизм повтора с экспоненциальной задержкой
- Реализовать circuit breaker для вызовов внешних API
- Добавить обработку таймаутов с отменой контекста
- Добавить логирование попыток повтора и срабатывания circuit breaker

**Граничные случаи/ошибки:**
- Ошибка механизма повтора
- Ошибка срабатывания circuit breaker
- Ошибка обработки таймаутов
- Неправильная настройка параметров повтора

**Безопасность и доступы:**
- Защита от DoS атак через повторные попытки
- Валидация параметров повтора

**Производительность и ресурсы:**
- Оптимизация параметров экспоненциальной задержки
- Эффективная реализация circuit breaker
- Минимизация накладных расходов на обработку таймаутов

**Зависимости от других задач:**
- TASK-9.1 (реализация типизированной системы ошибок)

**Миграции и обратная совместимость:**
- Нет breaking изменений
- Добавляются новые механизмы обработки ошибок без изменения существующего API

**Тесты:**
- Unit-тесты для механизма повтора
- Тесты срабатывания circuit breaker
- Тесты обработки таймаутов
- Интеграционные тесты с внешними API

**Артефакты/документация:**
- Обновить комментарии в internal/service/sonarqube/error_handling.go
- Добавить примеры использования в документацию

**Определение готовности (DoD):**
- [ ] Добавлен механизм повтора с экспоненциальной задержкой
- [ ] Реализован circuit breaker для вызовов внешних API
- [ ] Добавлена обработка таймаутов с отменой контекста
- [ ] Написаны unit-тесты (покрытие не менее 80%)
- [ ] Написаны интеграционные тесты
- [ ] Обновлена документация
- [ ] Пройдены все проверки линтеров
- [ ] Пройдены все тесты в CI/CD

**Критерии приёмки:**
1. WHEN происходит сетевая ошибка THEN система повторяет запрос согласно политике повторных попыток с экспоненциальной задержкой
2. WHEN внешний API недоступен THEN система срабатывает circuit breaker для защиты от каскадных сбоев
3. WHEN запрос превышает таймаут THEN система отменяет запрос с помощью контекста

### TASK-10.1: Расширение конфигурационных структур

**Связанные требования:** REQ-9
**Связанные пункты плана:** TASK-10.1 (из tasks.md)
**Связанные разделы дизайна:** DESIGN-8
**Точки входа в код:** internal/config/sonarqube.go, internal/config/config.go
**Что нужно изменить/добавить:**
- Добавить SonarQubeConfig и ScannerConfig в существующую систему конфигурации
- Реализовать валидацию конфигурации и значения по умолчанию
- Добавить поддержку переменных окружения для чувствительных данных
- Добавить методы для получения и установки конфигурации

**Граничные случаи/ошибки:**
- Ошибка загрузки конфигурации
- Ошибка валидации конфигурации
- Ошибка обработки переменных окружения
- Неправильные значения по умолчанию

**Безопасность и доступы:**
- Защита чувствительных данных в конфигурации
- Валидация конфигурационных параметров
- Ограничение доступа к конфигурации

**Производительность и ресурсы:**
- Эффективная загрузка и валидация конфигурации
- Минимизация накладных расходов на обработку переменных окружения

**Зависимости от других задач:**
- Нет

**Миграции и обратная совместимость:**
- Нет breaking изменений
- Добавляются новые структуры конфигурации без изменения существующего API

**Тесты:**
- Unit-тесты для структур конфигурации
- Тесты валидации конфигурации
- Тесты обработки переменных окружения
- Тесты значений по умолчанию

**Артефакты/документация:**
- Обновить комментарии в internal/config/sonarqube.go
- Обновить комментарии в internal/config/config.go
- Добавить примеры использования в документацию

**Определение готовности (DoD):**
- [ ] Добавлены SonarQubeConfig и ScannerConfig в существующую систему конфигурации
- [ ] Реализована валидация конфигурации и значения по умолчанию
- [ ] Добавлена поддержка переменных окружения для чувствительных данных
- [ ] Добавлены методы для получения и установки конфигурации
- [ ] Написаны unit-тесты (покрытие не менее 80%)
- [ ] Обновлена документация
- [ ] Пройдены все проверки линтеров
- [ ] Пройдены все тесты в CI/CD

**Критерии приёмки:**
1. WHEN система загружает конфигурацию THEN система добавляет SonarQubeConfig и ScannerConfig к существующей системе конфигурации
2. WHEN конфигурация загружена THEN система проверяет валидность параметров и устанавливает значения по умолчанию
3. WHEN система запускается THEN система загружает чувствительные данные из переменных окружения

### TASK-10.2: Интеграция конфигурационных файлов

**Связанные требования:** REQ-9
**Связанные пункты плана:** TASK-10.2 (из tasks.md)
**Связанные разделы дизайна:** DESIGN-8
**Точки входа в код:** internal/config/config.go
**Что нужно изменить/добавить:**
- Расширить app.yaml секциями sonarqube и scanner
- Добавить интеграцию с secret.yaml для токенов
- Реализовать возможность горячей перезагрузки конфигурации
- Добавить методы для обновления конфигурации во время выполнения

**Граничные случаи/ошибки:**
- Ошибка загрузки конфигурационных файлов
- Ошибка парсинга конфигурации
- Ошибка интеграции с secret.yaml
- Ошибка горячей перезагрузки конфигурации

**Безопасность и доступы:**
- Защита чувствительных данных в конфигурационных файлах
- Валидация конфигурационных параметров
- Ограничение доступа к конфигурационным файлам

**Производительность и ресурсы:**
- Эффективная загрузка и парсинг конфигурационных файлов
- Минимизация накладных расходов на горячую перезагрузку

**Зависимости от других задач:**
- TASK-10.1 (расширение конфигурационных структур)

**Миграции и обратная совместимость:**
- Нет breaking изменений
- Добавляются новые секции в конфигурационные файлы без изменения существующего API

**Тесты:**
- Интеграционные тесты загрузки конфигурационных файлов
- Тесты парсинга конфигурации
- Тесты интеграции с secret.yaml
- Тесты горячей перезагрузки конфигурации

**Артефакты/документация:**
- Обновить комментарии в internal/config/config.go
- Добавить примеры конфигурационных файлов в документацию
- Обновить документацию по конфигурации

**Определение готовности (DoD):**
- [ ] Расширены app.yaml секциями sonarqube и scanner
- [ ] Добавлена интеграция с secret.yaml для токенов
- [ ] Реализована возможность горячей перезагрузки конфигурации
- [ ] Добавлены методы для обновления конфигурации во время выполнения
- [ ] Написаны интеграционные тесты
- [ ] Обновлена документация
- [ ] Пройдены все проверки линтеров
- [ ] Пройдены все тесты в CI/CD

**Критерии приёмки:**
1. WHEN система загружает конфигурацию THEN система расширяет app.yaml секциями sonarqube и scanner
2. WHEN система загружает секреты THEN система интегрирует secret.yaml для хранения токенов
3. WHEN конфигурация изменяется THEN система может выполнить горячую перезагрузку конфигурации

### TASK-13.2: Подготовка артефактов развертывания

**Связанные требования:** REQ-11
**Связанные пункты плана:** TASK-13.2 (из tasks.md)
**Связанные разделы дизайна:** DESIGN-12
**Точки входа в код:** Dockerfile, .github/workflows/, Makefile
**Что нужно изменить/добавить:**
- Создать обновления конфигурации Docker
- Добавить модификации CI/CD pipeline
- Реализовать скрипты миграции базы данных при необходимости
- Создать документацию по развертыванию

**Граничные случаи/ошибки:**
- Ошибка обновления конфигурации Docker
- Ошибка модификации CI/CD pipeline
- Ошибка скриптов миграции
- Ошибка документации по развертыванию

**Безопасность и доступы:**
- Защита чувствительных данных в конфигурации Docker
- Валидация параметров развертывания
- Ограничение доступа к скриптам развертывания

**Производительность и ресурсы:**
- Оптимизация размера Docker образов
- Эффективные скрипты развертывания
- Минимизация накладных расходов на CI/CD

**Зависимости от других задач:**
- Все предыдущие задачи

**Миграции и обратная совместимость:**
- Нет breaking изменений
- Добавляются новые артефакты развертывания без изменения существующего API

**Тесты:**
- Тесты сборки Docker образов
- Тесты CI/CD pipeline
- Тесты скриптов миграции
- Тесты развертывания

**Артефакты/документации:**
- Обновить Dockerfile
- Обновить .github/workflows/
- Создать скрипты миграции при необходимости
- Создать документацию по развертыванию

**Определение готовности (DoD):**
- [ ] Созданы обновления конфигурации Docker
- [ ] Добавлены модификации CI/CD pipeline
- [ ] Реализованы скрипты миграции базы данных при необходимости
- [ ] Создана документация по развертыванию
- [ ] Пройдены все тесты развертывания
- [ ] Обновлена документация
- [ ] Пройдены все проверки линтеров
- [ ] Пройдены все тесты в CI/CD

**Критерии приёмки:**
1. WHEN проект собирается THEN система создает Docker образ с обновленной конфигурацией
2. WHEN CI/CD pipeline запускается THEN система выполняет все необходимые шаги для развертывания
3. WHEN развертывание выполняется THEN система применяет необходимые миграции базы данных
4. WHEN развертывание завершено THEN система предоставляет актуальную документацию по развертыванию

## 5. План рефакторинга/улучшений (без изменения внешнего поведения)

### Модульные границы, интерфейсы, зависимости
- Выделить четкие границы между слоями (entity, service, app)
- Уменьшить связность между компонентами
- Улучшить интерфейсы для лучшей тестируемости
- Внедрить dependency inversion для внешних зависимостей

### Обработка ошибок/логирование
- Стандартизировать форматы ошибок по всему проекту
- Улучшить контекстуальность сообщений об ошибках
- Добавить структурированное логирование с уровнями важности
- Реализовать централизованную обработку ошибок

### Конфигурация и параметры среды
- Консолидировать все конфигурационные параметры в единую систему
- Улучшить валидацию конфигурации на старте приложения
- Добавить поддержку конфигурации через переменные среды
- Реализовать механизм горячей перезагрузки конфигурации

### Улучшение тестопригодности (интерфейсы, контракты, mock/stub)
- Добавить интерфейсы для всех внешних зависимостей
- Создать фабрики для упрощения создания mock-объектов
- Улучшить изолированность unit-тестов
- Добавить контракты для всех публичных API

### Снижение технического долга, устранение дублирования
- Устранить дублирование кода между похожими компонентами
- Улучшить архитектурную консистентность
- Обновить устаревшие паттерны и подходы
- Добавить недостающую документацию к коду

## 6. План тестирования и качество

### Стратегия тестов (юнит/интеграция/e2e), приоритеты
- Юнит-тесты для всех бизнес-функций (приоритет высокий)
- Интеграционные тесты для взаимодействия с внешними системами (приоритет высокий)
- E2E тесты для критических пользовательских сценариев (приоритет средний)
- Тесты производительности для ресурсоемких операций (приоритет низкий)

### Покрытие (цели/минимумы)
- Минимальное покрытие кода: 80%
- Идеальное покрытие кода: 90%
- Покрытие критических путей: 100%
- Покрытие обработчиков ошибок: 90%

### Инварианты, idempotency, ретраи, таймауты, контексты
- Проверка инвариантов состояния перед и после операций
- Обеспечение идемпотентности для повторяемых операций
- Тестирование механизмов повтора и таймаутов
- Проверка корректной обработки контекстов отмены

### Гейты CI (линтеры, `go vet`, `staticcheck`, SonarQube правила)
- Интеграция всех линтеров в CI pipeline
- Настройка правил `go vet` и `staticcheck`
- Интеграция с SonarQube для анализа качества кода
- Добавление проверок безопасности в CI pipeline

### Нефункциональные проверки (память/время/параллельность)
- Тесты утечек памяти
- Бенчмарки производительности
- Тесты конкурентного доступа
- Проверки ограничения ресурсов

## 7. Риски и меры их снижения

### Матрица рисков (влияние/вероятность, меры)
| Риск | Влияние | Вероятность | Меры снижения |
|------|---------|-------------|---------------|
| Ошибки интеграции с SonarQube API | Высокое | Средняя | Подробное тестирование API, mock-сервер для тестов |
| Ошибки работы с sonar-scanner | Высокое | Средняя | Тестирование в различных окружениях, обработка ошибок |
| Проблемы с производительностью при сканировании больших проектов | Среднее | Низкая | Оптимизация алгоритмов, ограничение ресурсов |
| Ошибки безопасности при обработке токенов | Высокое | Низкая | Аудит кода, шифрование чувствительных данных |
| Недостаточное тестовое покрытие | Высокое | Высокая | Code coverage метрики, обязательные тесты для новых функций |

### План отката (rollback), фичефлаги/тумблеры
- Реализовать фичефлаги для всех новых функций SonarQube
- Подготовить скрипты отката конфигурации
- Создать точки восстановления для базы данных (если применимо)
- Документировать процедуру отката изменений

## 8. Список артефактов к обновлению

### Документация (README, ADR, комментарии GoDoc)
- Обновить README.md с описанием новых функций
- Создать ADR по архитектурным решениям интеграции
- Добавить комментарии GoDoc ко всем публичным API
- Создать руководство пользователя для команд SonarQube

### Конфиги, схемы, диаграммы
- Обновить примеры конфигурационных файлов
- Создать схемы архитектуры интеграции
- Обновить диаграммы последовательности работы команд
- Добавить схемы потоков данных

### CI/CD (скрипты, пайплайны)
- Обновить скрипты сборки и тестирования
- Добавить шаги проверки качества кода
- Настроить деплой новых функций
- Добавить мониторинг и алертинг

## 9. Приложения

### Полный список найденных `ToDo/TODO/FIXME/STUB` с контекстами
См. раздел 3 "Индекс незавершенных участков кода"

### Список внешних зависимостей и их влияния
- github.com/ilyakaznacheev/cleanenv - для работы с конфигурацией
- gopkg.in/yaml.v3 - для парсинга YAML файлов
- log/slog - для структурированного логирования
- github.com/stretchr/testify - для unit-тестов
- net/http - для HTTP клиентов
- archive/zip - для работы с архивами scanner'а

### Ссылки на ключевые участки кода/коммиты
- internal/entity/sonarqube/ - реализация низкоуровневых взаимодействий
- internal/service/sonarqube/ - реализация бизнес-логики
- internal/config/ - конфигурация приложения