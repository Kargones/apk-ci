# Детальный план реализации архитектуры ActionMenuBuild

## Этап 1: Подготовка инфраструктуры и базовых компонентов

### 1.1. Создание структур данных
**Архитектурный раздел:** 6.1. Основные структуры  
**Требования:** 3.2.3, 5.3.2  
**Инструкция по загрузке контекста:** Загрузите требования 3.2.3, 5.3.2 из файла `refact-36.md`  
**Описание:** Создать основные структуры данных для работы с шаблонами и конфигурацией  
**Выполнено:** ☐

### 1.2. Создание системы обработки ошибок
**Архитектурный раздел:** 5.1. Стратегия обработки ошибок  
**Требования:** 9.1.1, 9.1.2, 9.1.3, 9.2.1, 9.2.2, 9.2.3, 9.2.4  
**Инструкция по загрузке контекста:** Загрузите требования 9.1.1, 9.1.2, 9.1.3, 9.2.1, 9.2.2, 9.2.3, 9.2.4 из файла `refact-36.md`  
**Описание:** Реализовать кастомный тип ошибок ActionMenuBuildError и стратегию wrapped errors  
**Выполнено:** ☐

### 1.3. Добавление констант в модуль constants
**Архитектурный раздел:** 3.1. Модуль хранения шаблонов, 8.2. Интеграция с модулем constants  
**Требования:** 4.2.1, 4.2.2, 5.1.1, 5.1.2, 5.1.3, 6.1.1, 6.1.2, 6.1.3, 6.2.1, 6.2.2, 6.2.3, 6.3.1, 6.3.2, 6.3.3  
**Инструкция по загрузке контекста:** Загрузите требования 4.2.1, 4.2.2, 5.1.1, 5.1.2, 5.1.3, 6.1.1, 6.1.2, 6.1.3, 6.2.1, 6.2.2, 6.2.3, 6.3.1, 6.3.2, 6.3.3 из файла `refact-36.md` и раздел 10 из файла `refact-36-architecture.md`  
**Описание:** Добавить константу ActionMenuBuildName и все шаблоны YAML в модуль constants с использованием raw string literals  
**Выполнено:** ☐

## Этап 2: Реализация модулей проверки и анализа

### 2.1. Реализация модуля проверки изменений project.yaml
**Архитектурный раздел:** 2.1. Модуль проверки изменений  
**Требования:** 2.1.1, 2.1.2, 2.2.1, 2.2.2, 2.2.3  
**Инструкция по загрузке контекста:** Загрузите требования 2.1.1, 2.1.2, 2.2.1, 2.2.2, 2.2.3 из файла `refact-36.md`  
**Описание:** Создать функцию checkProjectYamlChanges для определения ветки по умолчанию и проверки изменений файла project.yaml  
**Выполнено:** ☐

### 2.2. Реализация модуля анализа конфигурации
**Архитектурный раздел:** 2.2. Модуль анализа конфигурации, 8.3. Интеграция с системой конфигурации  
**Требования:** 3.1.1, 3.1.2, 3.1.3, 3.2.1, 3.2.2, 3.2.3  
**Инструкция по загрузке контекста:** Загрузите требования 3.1.1, 3.1.2, 3.1.3, 3.2.1, 3.2.2, 3.2.3 из файла `refact-36.md`  
**Описание:** Создать функцию analyzeProjectConfig для валидации конфигурации и извлечения данных для шаблонов  
**Выполнено:** ☐

## Этап 3: Реализация системы генерации содержимого

### 3.1. Реализация модуля парсинга имен файлов
**Архитектурный раздел:** 3.2. Модуль парсинга имен файлов  
**Требования:** 5.2.1, 5.2.2, 5.2.3  
**Инструкция по загрузке контекста:** Загрузите требования 5.2.1, 5.2.2, 5.2.3 из файла `refact-36.md`  
**Описание:** Создать функцию parseFileName с регулярным выражением для извлечения имен файлов из шаблонов  
**Выполнено:** ☐

### 3.2. Реализация модуля генерации содержимого
**Архитектурный раздел:** 3.3. Модуль генерации содержимого  
**Требования:** 5.3.1, 5.3.2, 5.3.3  
**Инструкция по загрузке контекста:** Загрузите требования 5.3.1, 5.3.2, 5.3.3 из файла `refact-36.md`  
**Описание:** Создать функцию generateFileContent с использованием text/template для подстановки данных в шаблоны  
**Выполнено:** ☐

### 3.3. Реализация функции генерации всех файлов
**Архитектурный раздел:** 7.1. Основной алгоритм (шаг 4)  
**Требования:** 5.1.1, 5.1.2, 5.1.3, 5.2.1, 5.2.2, 5.2.3, 5.3.1, 5.3.2, 5.3.3, 6.1.1, 6.1.2, 6.1.3, 6.2.1, 6.2.2, 6.2.3, 6.3.1, 6.3.2, 6.3.3  
**Инструкция по загрузке контекста:** Загрузите требования 5.1.1-5.3.3, 6.1.1-6.3.3 из файла `refact-36.md`  
**Описание:** Создать функцию generateFiles, которая объединяет парсинг имен и генерацию содержимого для всех шаблонов  
**Выполнено:** ☐

## Этап 4: Реализация системы управления файлами

### 4.1. Реализация модуля получения текущих файлов Actions
**Архитектурный раздел:** 2.3. Модуль управления файлами Actions (часть 1)  
**Требования:** 4.1.1, 4.1.2, 4.1.3  
**Инструкция по загрузке контекста:** Загрузите требования 4.1.1, 4.1.2, 4.1.3 из файла `refact-36.md`  
**Описание:** Создать функцию getCurrentActions для получения списка существующих файлов через Gitea API  
**Выполнено:** ☐

### 4.2. Реализация модуля создания файлов
**Архитектурный раздел:** 4.1. Модуль создания файлов  
**Требования:** 7.1.1, 7.1.2, 7.1.3  
**Инструкция по загрузке контекста:** Загрузите требования 7.1.1, 7.1.2, 7.1.3 из файла `refact-36.md`  
**Описание:** Создать функцию createWorkflowFiles для создания файлов в каталоге .gitea/workflows через Gitea API  
**Выполнено:** ☐

### 4.3. Реализация модуля удаления устаревших файлов
**Архитектурный раздел:** 2.3. Модуль управления файлами Actions (часть 2)  
**Требования:** 7.2.1, 7.2.2, 7.2.3  
**Инструкция по загрузке контекста:** Загрузите требования 7.2.1, 7.2.2, 7.2.3 из файла `refact-36.md`  
**Описание:** Создать функцию removeObsoleteFiles для безопасного удаления устаревших файлов  
**Выполнено:** ☐

## Этап 5: Реализация системы коммита изменений

### 5.1. Реализация модуля коммита изменений
**Архитектурный раздел:** 4.2. Модуль коммита изменений  
**Требования:** 8.1.1, 8.1.2, 8.2.1, 8.2.2  
**Инструкция по загрузке контекста:** Загрузите требования 8.1.1, 8.1.2, 8.2.1, 8.2.2 из файла `refact-36.md`  
**Описание:** Создать функцию commitChanges для формирования сообщения коммита и выполнения коммита через Gitea API  
**Выполнено:** ☐

## Этап 6: Реализация основной функции

### 6.1. Реализация основной функции ActionMenuBuild
**Архитектурный раздел:** 1.1. Модульная структура, 7.1. Основной алгоритм  
**Требования:** 1.1, 1.2.1, 1.2.2, 1.2.3, 10.1.1, 10.1.2, 10.1.3, 10.2.1, 10.2.2, 10.2.3  
**Инструкция по загрузке контекста:** Загрузите требования 1.1, 1.2.1, 1.2.2, 1.2.3, 10.1.1, 10.1.2, 10.1.3, 10.2.1, 10.2.2, 10.2.3 из файла `refact-36.md` и раздел 7.1 из файла `refact-36-architecture.md`  
**Описание:** Создать публичную функцию ActionMenuBuild, которая координирует выполнение всех этапов согласно основному алгоритму  
**Выполнено:** ☐

### 6.2. Интеграция с модулем app
**Архитектурный раздел:** 1.1. Модульная структура, 8.1. Интеграция с Gitea API  
**Требования:** 1.1, 1.2.1, 1.2.2, 10.2.3  
**Инструкция по загрузке контекста:** Загрузите требования 1.1, 1.2.1, 1.2.2, 10.2.3 из файла `refact-36.md`  
**Описание:** Интегрировать функцию ActionMenuBuild в модуль app и обеспечить доступ к Gitea API  
**Выполнено:** ☐

## Этап 7: Тестирование и валидация

### 7.1. Создание модульных тестов
**Архитектурный раздел:** 9.1. Стратегия тестирования  
**Требования:** 10.1.2, 9.1.3  
**Инструкция по загрузке контекста:** Загрузите требования 10.1.2, 9.1.3 из файла `refact-36.md`  
**Описание:** Создать модульные тесты для каждой приватной функции с проверкой различных сценариев  
**Выполнено:** ☐

### 7.2. Создание интеграционных тестов
**Архитектурный раздел:** 9.1. Стратегия тестирования  
**Требования:** 10.1.2, 9.1.3  
**Инструкция по загрузке контекста:** Загрузите требования 10.1.2, 9.1.3 из файла `refact-36.md`  
**Описание:** Создать интеграционные тесты для работы с Gitea API и валидации шаблонов  
**Выполнено:** ☐

### 7.3. Валидация критериев качества
**Архитектурный раздел:** 9.2. Критерии качества  
**Требования:** 5.2.3, 5.3.3, 7.2.3  
**Инструкция по загрузке контекста:** Загрузите требования 5.2.3, 5.3.3, 7.2.3 из файла `refact-36.md`  
**Описание:** Провести валидацию надежности парсинга, корректности генерации и безопасности операций  
**Выполнено:** ☐

## Этап 8: Финализация и документация

### 8.1. Проверка соответствия архитектурным принципам
**Архитектурный раздел:** 1.2. Принципы проектирования  
**Требования:** 10.1.2, 10.1.3, 10.2.1, 10.2.2  
**Инструкция по загрузке контекста:** Загрузите требования 10.1.2, 10.1.3, 10.2.1, 10.2.2 из файла `refact-36.md`  
**Описание:** Проверить соблюдение принципов единственной ответственности, минимизации зависимостей и читаемости кода  
**Выполнено:** ☐

### 8.2. Финальное тестирование системы
**Архитектурный раздел:** 7.1. Основной алгоритм  
**Требования:** Все требования в логической последовательности  
**Инструкция по загрузке контекста:** Загрузите все функциональные требования из файла `refact-36.md`  
**Описание:** Провести полное тестирование системы с реальными данными конфигурации  
**Выполнено:** ☐

### 8.3. Создание документации по использованию
**Архитектурный раздел:** 1.1. Модульная структура  
**Требования:** 1.1, 10.1.2  
**Инструкция по загрузке контекста:** Загрузите требования 1.1, 10.1.2 из файла `refact-36.md`  
**Описание:** Создать документацию по использованию функции ActionMenuBuild и её интеграции  
**Выполнено:** ☐

---

## Общий прогресс выполнения

**Всего пунктов:** 18  
**Выполнено:** 0  
**Прогресс:** 0%

## Примечания по реализации

1. **Последовательность выполнения:** Этапы должны выполняться в указанном порядке, так как каждый последующий этап зависит от предыдущих.

2. **Загрузка контекста:** Перед началом работы над каждым пунктом обязательно загрузите в контекст указанные требования из соответствующих файлов.

3. **Тестирование:** После завершения каждого этапа рекомендуется проводить промежуточное тестирование для раннего выявления проблем.

4. **Интеграция:** Особое внимание следует уделить интеграционным точкам с существующими модулями проекта.

5. **Обработка ошибок:** На всех этапах необходимо следовать единой стратегии обработки ошибок с использованием wrapped errors.

## Ссылки на документы

- **Функциональные требования:** `/root/r/apk-ci-apk/promts/refact-36.md`
- **Архитектурное описание:** `/root/r/apk-ci-apk/promts/refact-36-architecture.md`
- **План реализации:** `/root/r/apk-ci-apk/promts/refact-36-implementation-plan.md` (текущий документ)