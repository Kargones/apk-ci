# Epic 1: Architectural Foundation

**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å SOLID-—Å–æ–≤–º–µ—Å—Ç–∏–º—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é –æ—Å–Ω–æ–≤—É —Å DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º, Command Registry, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≤—ã–≤–æ–¥–æ–º –∏ –±–∞–∑–æ–≤—ã–º observability. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è ‚Äî –ø–µ—Ä–≤–∞—è NR-–∫–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ production.

**FRs:** FR1-5, FR29-35, FR41-43, FR47-50

**–¶–µ–Ω–Ω–æ—Å—Ç—å:** Wire DI + Command Registry + Output + Logging + Tracing + –ø–µ—Ä–≤–∞—è NR-–∫–æ–º–∞–Ω–¥–∞

### –í–æ–ª–Ω—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º)

```
–í–û–õ–ù–ê 1 (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ):     1.1 Registry | 1.3 Output+Errors | 1.4 Logger | 1.6 Config
                                ‚îÇ                ‚îÇ                ‚îÇ
–í–û–õ–ù–ê 2:                        ‚îÇ                ‚îÇ                ‚îÇ
                           1.2 Deprecated   1.5 TraceID ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ                ‚îÇ
–í–û–õ–ù–ê 3:                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ 1.7 Wire DI
                                                              ‚îÇ
–í–û–õ–ù–ê 4:                                                 1.8 nr-version
                                                              ‚îÇ
–í–û–õ–ù–ê 5:                                                 1.9 Help
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å:** 1.1 ‚Üí 1.2 ‚Üí 1.7 ‚Üí 1.8 ‚Üí 1.9 (5 –∏—Å—Ç–æ—Ä–∏–π)

### Decision Matrix Summary

| Story | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | Score | –ö–ª—é—á–µ–≤–æ–π —Ñ–∞–∫—Ç–æ—Ä |
|-------|-----------|-------|-----------------|
| 1.1 Registry | ü•á 1 | 38 | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (5 –∏—Å—Ç–æ—Ä–∏–π –∑–∞–≤–∏—Å—è—Ç) |
| 1.3 Output | ü•à 2 | 37 | –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ |
| 1.4 Logger | ü•â 3 | 31 | Observability —Å –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è |
| 1.7 Wire DI | ‚ö†Ô∏è | 36 | –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ (4/5), –º–Ω–æ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π |
| 1.9 Help | 9 | 12 | Nice-to-have, –º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å |

### Pre-mortem: –ö–ª—é—á–µ–≤—ã–µ —Ä–∏—Å–∫–∏

| ID | Failure Mode | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è –≤ AC |
|----|--------------|-------------|---------|----------------|
| FM1 | Wire DI –Ω–µ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ–µ | Unit-—Ç–µ—Å—Ç—ã providers, `go generate` –≤ CI |
| FM2 | Registry –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å main.go | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | Fallback –ª–æ–≥–∏–∫–∞, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É—Ç–∏ |
| FM3 | JSON breaking changes | –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | Golden tests, JSON Schema, API version |
| FM4 | –õ–æ–≥–∏ —Å–º–µ—à–∏–≤–∞—é—Ç—Å—è —Å output | –í—ã—Å–æ–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | Logger‚Üístderr, –∑–∞–ø—Ä–µ—Ç fmt.Print* |
| FM5 | CI build –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç local | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | CI —Ç–µ—Å—Ç –±–∏–Ω–∞—Ä–Ω–∏–∫–∞, fallback build info |
| FM6 | Config –ª–æ–º–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ–µ | Optional –ø–æ–ª—è, backward compat —Ç–µ—Å—Ç |

### Six Thinking Hats Summary

| Hat | Insight | –î–µ–π—Å—Ç–≤–∏–µ |
|-----|---------|----------|
| ‚ö™ White | –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ downstream JSON –ø–∞—Ä—Å–µ—Ä–∞—Ö | –°–æ–±—Ä–∞—Ç—å production –∫–æ–Ω—Ñ–∏–≥–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ |
| üî¥ Red | Wire –≤—ã–∑—ã–≤–∞–µ—Ç –±–µ—Å–ø–æ–∫–æ–π—Å—Ç–≤–æ (–Ω–æ–≤–∞—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è) | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ |
| ‚ö´ Black | Registry –º–æ–∂–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ | CI check: –Ω–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ Registry |
| üü° Yellow | –ü–æ—Å–ª–µ Epic 1 ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã = 1 —Ñ–∞–π–ª | –ö–æ–º–º—É–Ω–∏—Ü–∏—Ä–æ–≤–∞—Ç—å vision –∫–æ–º–∞–Ω–¥–µ |
| üü¢ Green | nr-health –ø–æ–ª–µ–∑–Ω–µ–µ nr-version –¥–ª—è production | –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞–∫ Story 1.8b (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| üîµ Blue | –ù—É–∂–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ | Code review checklist –¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã |

**–î–µ–π—Å—Ç–≤–∏—è –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º Epic 1:**
- [ ] –°–æ–±—Ä–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã production –∫–æ–Ω—Ñ–∏–≥–æ–≤ –¥–ª—è backward compatibility —Ç–µ—Å—Ç–æ–≤
- [ ] –°–æ–∑–¥–∞—Ç—å Wiki —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ Wire —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI check: —Ñ–∞–π–ª—ã –≤ `internal/command/handlers/` –¥–æ–ª–∂–Ω—ã –≤—ã–∑—ã–≤–∞—Ç—å `command.Register()`

---

### Story 1.1: Command Registry —Å self-registration

**As a** —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫,
**I want** —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ init() –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è main.go,
**So that** –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Open/Closed Principle.

**Acceptance Criteria:**

**Given** –Ω–æ–≤—ã–π handler —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π interface Handler
**When** handler –≤—ã–∑—ã–≤–∞–µ—Ç command.Register() –≤ init()
**Then** –∫–æ–º–∞–Ω–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ command.Get(name)

**And** Registry –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç (nil, false) –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–º–∞–Ω–¥
**And** –ø–æ–≤—Ç–æ—Ä–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å —Ç–µ–º –∂–µ –∏–º–µ–Ω–µ–º –ø–∞–Ω–∏–∫—É–µ—Ç (programming error)
**And** main.go: —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç Registry, –ø–æ—Ç–æ–º fallback –Ω–∞ legacy switch
**And** –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫–æ–π –ø—É—Ç—å –≤—ã–±—Ä–∞–Ω ("registry" –∏–ª–∏ "legacy") –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

**Prerequisites:** ‚Äî

**Technical Notes:**
- –§–∞–π–ª—ã: `internal/command/registry.go`, `internal/command/handler.go`
- Handler interface: `Name() string`, `Execute(ctx, cfg) error`
- Thread-safe –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –≤ init)
- Ref: Architecture ADR-002
- ‚ö†Ô∏è Pre-mortem FM2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å main.go —Ç—Ä–µ–±—É–µ—Ç fallback –ª–æ–≥–∏–∫–∏

---

### Story 1.2: NR-Migration Bridge (DeprecatedBridge)

**As a** DevOps-–∏–Ω–∂–µ–Ω–µ—Ä,
**I want** –ø–æ–ª—É—á–∞—Ç—å warning –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ deprecated –∫–æ–º–∞–Ω–¥,
**So that** —è –∑–Ω–∞—é –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ NR-–≤–µ—Ä—Å–∏–∏.

**Acceptance Criteria:**

**Given** –∫–æ–º–∞–Ω–¥–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ RegisterWithAlias(handler, "old-name")
**When** –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ä–æ–µ –∏–º—è –∫–æ–º–∞–Ω–¥—ã
**Then** –≤—ã–≤–æ–¥–∏—Ç—Å—è warning –≤ stderr —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤–æ–µ –∏–º—è
**And** –∫–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ actual handler

**And** warning —Å–æ–¥–µ—Ä–∂–∏—Ç: —Å—Ç–∞—Ä–æ–µ –∏–º—è, –Ω–æ–≤–æ–µ –∏–º—è, —Ç–µ–∫—Å—Ç "deprecated"
**And** warning –≤—ã–≤–æ–¥–∏—Ç—Å—è –Ω–∞ –∫–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ (–Ω–µ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è)

**Prerequisites:** Story 1.1

**Technical Notes:**
- –§–∞–π–ª: `internal/command/deprecated.go`
- DeprecatedBridge struct —Å –ø–æ–ª—è–º–∏: actual Handler, deprecated string, newName string
- Warning —á–µ—Ä–µ–∑ log.Warn (–ø–æ—Å–ª–µ Story 1.5) –∏–ª–∏ fmt.Fprintf(os.Stderr) –≤—Ä–µ–º–µ–Ω–Ω–æ
- Ref: Architecture Pattern "NR-Migration Bridge"

---

### Story 1.3: OutputWriter + Structured Errors

**As a** DevOps-–∏–Ω–∂–µ–Ω–µ—Ä,
**I want** –ø–æ–ª—É—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–º–∞–Ω–¥ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏,
**So that** —è –º–æ–≥—É –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å apk-ci —Å –¥—Ä—É–≥–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.

**Acceptance Criteria:**

**Given** BR_OUTPUT_FORMAT=json
**When** –∫–æ–º–∞–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
**Then** —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ stdout –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:
```json
{
  "status": "success",
  "command": "command-name",
  "data": { ... },
  "metadata": { "duration_ms": 123 }
}
```

**And** BR_OUTPUT_FORMAT=text –≤—ã–≤–æ–¥–∏—Ç —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
**And** –æ—à–∏–±–∫–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –ø–æ–ª–µ "error": {"code": "...", "message": "..."}
**And** –ª–æ–≥–∏ –ù–ï —Å–º–µ—à–∏–≤–∞—é—Ç—Å—è —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º (–ª–æ–≥–∏ ‚Üí stderr)

**Given** –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π
**When** –æ—à–∏–±–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
**Then** –æ—à–∏–±–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç: Code (–º–∞—à–∏–Ω–æ—á–∏—Ç–∞–µ–º—ã–π), Message (—á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–π)

**And** AppError —Ä–µ–∞–ª–∏–∑—É–µ—Ç error interface
**And** AppError –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Unwrap() –¥–ª—è error wrapping
**And** —Å–µ–∫—Ä–µ—Ç—ã (–ø–∞—Ä–æ–ª–∏, —Ç–æ–∫–µ–Ω—ã) –ù–ò–ö–û–ì–î–ê –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ Message
**And** JSON output –∏–º–µ–µ—Ç –≤–µ—Ä—Å–∏—é API –≤ metadata ("api_version": "v1")
**And** Golden file —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å JSON —Ñ–æ—Ä–º–∞—Ç–∞
**And** JSON Schema –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –¥–ª—è Result struct

**Prerequisites:** ‚Äî

**Technical Notes:**
- –§–∞–π–ª—ã: `internal/pkg/output/writer.go`, `text.go`, `json.go`, `internal/pkg/errors/errors.go`
- Writer interface: `Write(w io.Writer, result *Result) error`
- Result struct —Å–æ–≥–ª–∞—Å–Ω–æ Architecture "Format Patterns"
- –ö–æ–¥—ã –æ—à–∏–±–æ–∫: ERR_CONFIG_LOAD, ERR_DB_CONNECTION, ERR_SERVICE_MODE, etc.
- YAML formatter –æ—Ç–ª–æ–∂–µ–Ω –¥–æ Epic 7
- ‚ö†Ô∏è Pre-mortem FM3: Golden tests –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç breaking changes –≤ JSON

---

### Story 1.4: Logger interface + slog adapter

**As a** DevOps-–∏–Ω–∂–µ–Ω–µ—Ä,
**I want** –ø–æ–ª—É—á–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ JSON –ª–æ–≥–∏,
**So that** —è –º–æ–≥—É –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏.

**Acceptance Criteria:**

**Given** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ —Å logging.format=json
**When** –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
**Then** –∑–∞–ø–∏—Å—å —Å–æ–¥–µ—Ä–∂–∏—Ç: timestamp, level, msg, –∏ –≤—Å–µ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã

**And** –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —É—Ä–æ–≤–Ω–∏: DEBUG, INFO, WARN, ERROR
**And** —É—Ä–æ–≤–µ–Ω—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
**And** Logger.With(args) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–π logger —Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏
**And** Logger –ø–∏—à–µ—Ç –¢–û–õ–¨–ö–û –≤ stderr (–Ω–∏–∫–æ–≥–¥–∞ –≤ stdout)
**And** golangci-lint –ø—Ä–∞–≤–∏–ª–æ –∑–∞–ø—Ä–µ—â–∞–µ—Ç fmt.Print* –≤ production –∫–æ–¥–µ

**Prerequisites:** ‚Äî

**Technical Notes:**
- –§–∞–π–ª—ã: `internal/pkg/logging/logger.go`, `slog.go`
- Logger interface –∞–±—Å—Ç—Ä–∞–≥–∏—Ä—É–µ—Ç slog –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- File rotation –æ—Ç–ª–æ–∂–µ–Ω–∞ –¥–æ Epic 6
- Ref: Architecture ADR-005
- ‚ö†Ô∏è Pre-mortem FM4: –õ–æ–≥–∏ –≤ stdout –ª–æ–º–∞—é—Ç JSON –ø–∞—Ä—Å–µ—Ä—ã downstream

---

### Story 1.5: Trace ID generation

**As a** DevOps-–∏–Ω–∂–µ–Ω–µ—Ä,
**I want** –∏–º–µ—Ç—å trace_id –≤ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ –ª–æ–≥–∞,
**So that** —è –º–æ–≥—É –∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏ –æ–¥–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏.

**Acceptance Criteria:**

**Given** –∫–æ–º–∞–Ω–¥–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
**When** –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è trace_id
**Then** trace_id –∏–º–µ–µ—Ç —Ñ–æ—Ä–º–∞—Ç UUID v4 –∏–ª–∏ 16-byte hex string

**And** trace_id –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ context
**And** –≤—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –ª–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç trace_id
**And** trace_id –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ JSON output metadata

**Prerequisites:** Story 1.4

**Technical Notes:**
- –§–∞–π–ª: `internal/pkg/tracing/traceid.go`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å crypto/rand –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- OpenTelemetry export –æ—Ç–ª–æ–∂–µ–Ω –¥–æ Epic 6
- Context key: type traceIDKey struct{}

---

### Story 1.6: Config extensions (implementations, logging sections)

**As a** DevOps-–∏–Ω–∂–µ–Ω–µ—Ä,
**I want** –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –≤—ã–±–æ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é,
**So that** —è –º–æ–≥—É –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É 1cv8/ibcmd –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞.

**Acceptance Criteria:**

**Given** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–µ–∫—Ü–∏—é implementations
**When** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
**Then** –¥–æ—Å—Ç—É–ø–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è: implementations.config_export, implementations.db_create

**And** —Å–µ–∫—Ü–∏—è logging —Å–æ–¥–µ—Ä–∂–∏—Ç: format, level, file (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
**And** –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: config_export="1cv8", format="text", level="info"
**And** –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
**And** –í–°–ï –Ω–æ–≤—ã–µ –ø–æ–ª—è optional —Å —Ä–∞–∑—É–º–Ω—ã–º–∏ defaults
**And** —Ç–µ—Å—Ç: —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π production –∫–æ–Ω—Ñ–∏–≥ –ø–∞—Ä—Å–∏—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ (backward compatibility)

**Prerequisites:** ‚Äî

**Technical Notes:**
- –§–∞–π–ª: `internal/config/config.go` (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ)
- –ù–æ–≤—ã–µ struct: ImplementationsConfig, LoggingConfig
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
- ‚ö†Ô∏è Pre-mortem FM6: Required –ø–æ–ª—è –±–µ–∑ defaults –ª–æ–º–∞—é—Ç —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏

---

### Story 1.7: Wire DI setup + providers

**As a** —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫,
**I want** –ø–æ–ª—É—á–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ Wire injection,
**So that** –∫–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç Dependency Inversion Principle.

**Acceptance Criteria:**

**Given** Wire definitions –≤ internal/di/wire.go
**When** –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è go generate ./internal/di/...
**Then** –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è wire_gen.go —Å injector —Ñ—É–Ω–∫—Ü–∏—è–º–∏

**And** –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –¥–ª—è: Config, Logger, OutputWriter
**And** –æ—à–∏–±–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
**And** —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤—ã–∑—ã–≤–∞—é—Ç –æ—à–∏–±–∫—É –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
**And** unit-—Ç–µ—Å—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ provider (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ nil)
**And** `go generate ./internal/di/...` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ CI pipeline
**And** –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö `interfaces.go`

**Prerequisites:** Story 1.1, 1.3, 1.4

**Technical Notes:**
- –§–∞–π–ª—ã: `internal/di/wire.go`, `providers.go`, `wire_gen.go` (generated)
- Ref: Architecture ADR-001
- Wire v0.6.0
- ‚ö†Ô∏è Pre-mortem FM1: Wire ‚Äî –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫, —Ç—Ä–µ–±—É–µ—Ç —Ç—â–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

### Story 1.8: First NR-command: nr-version

**As a** DevOps-–∏–Ω–∂–µ–Ω–µ—Ä,
**I want** –≤—ã–ø–æ–ª–Ω–∏—Ç—å nr-version –∫–æ–º–∞–Ω–¥—É,
**So that** —è –º–æ–≥—É –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç.

**Acceptance Criteria:**

**Given** BR_COMMAND=nr-version
**When** –∫–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
**Then** –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, Go –≤–µ—Ä—Å–∏—è, –¥–∞—Ç–∞ —Å–±–æ—Ä–∫–∏

**And** –≤—ã–≤–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç OutputWriter —Ñ–æ—Ä–º–∞—Ç—É (text/JSON)
**And** –∫–æ–º–∞–Ω–¥–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ Registry
**And** trace_id –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –ª–æ–≥–∞—Ö
**And** exit code = 0 –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
**And** fallback –∑–Ω–∞—á–µ–Ω–∏—è –µ—Å–ª–∏ build info –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (version="dev", date="unknown")
**And** CI job —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Å–æ–±—Ä–∞–Ω–Ω—ã–π –±–∏–Ω–∞—Ä–Ω–∏–∫ (–Ω–µ `go run`)
**And** stdout —Å–æ–¥–µ—Ä–∂–∏—Ç –¢–û–õ–¨–ö–û Result JSON (—Ç–µ—Å—Ç –Ω–∞ "—á–∏—Å—Ç–æ—Ç—É" –≤—ã–≤–æ–¥–∞)
**And** –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç: Registry + legacy switch —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ

**Prerequisites:** Story 1.1-1.7

**Technical Notes:**
- –§–∞–π–ª—ã: `internal/command/handlers/version/version.go`
- Build info —á–µ—Ä–µ–∑ runtime/debug.ReadBuildInfo() –∏–ª–∏ ldflags
- –≠—Ç–æ proof of concept –¥–ª—è –≤—Å–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã Epic 1
- Makefile target: `build-with-version` —Å ldflags
- ‚ö†Ô∏è Pre-mortem FM5: `go run` —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–æ–±—Ä–∞–Ω–Ω—ã–π –±–∏–Ω–∞—Ä–Ω–∏–∫ ‚Äî –Ω–µ—Ç

---

### Story 1.9: Auto-generated help from Registry

**As a** DevOps-–∏–Ω–∂–µ–Ω–µ—Ä,
**I want** –≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥,
**So that** —è –∑–Ω–∞—é –∫–∞–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –±–µ–∑ —á—Ç–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

**Acceptance Criteria:**

**Given** BR_COMMAND=help –∏–ª–∏ BR_COMMAND –Ω–µ –∑–∞–¥–∞–Ω
**When** –∫–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
**Then** –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏

**And** deprecated –∫–æ–º–∞–Ω–¥—ã –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ [deprecated]
**And** NR-–∫–æ–º–∞–Ω–¥—ã –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç legacy
**And** –≤—ã–≤–æ–¥ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç text/JSON —Ñ–æ—Ä–º–∞—Ç

**Prerequisites:** Story 1.1, 1.2, 1.8

**Technical Notes:**
- –§–∞–π–ª: `internal/command/help.go`
- Handler interface —Ä–∞—Å—à–∏—Ä–∏—Ç—å: Description() string (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞: –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏–ª–∏ –∞–ª—Ñ–∞–≤–∏—Ç—É
