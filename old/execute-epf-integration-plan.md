# План интеграции функционала execute-epf

## Обзор

Данный документ содержит детальный пошаговый план интеграции новой команды `execute-epf` в проект Benadis Runner. План основан на архитектурном документе `execute-epf-architecture.md` и обеспечивает постепенную интеграцию с возможностью отката.

## Статус выполнения

**Общий прогресс**: 0/10 задач выполнено

## Этап 1: Подготовительные работы

### 1.1 Добавление констант
- [ ] **Задача**: Добавить константу `ActExecuteEpf` в `internal/constants/constants.go`
- **Приоритет**: Высокий
- **Ссылка на архитектуру**: Раздел 5.1
- **Описание**: Добавить новую константу команды `ActExecuteEpf = "execute-epf"`
- **Критерии готовности**: Константа добавлена и доступна для использования
- **Возможность отката**: Удалить добавленную константу

### 1.2 Расширение конфигурации - InputParams
- [ ] **Задача**: Расширить структуру `InputParams` в `internal/config/config.go`
- **Приоритет**: Высокий
- **Ссылка на архитектуру**: Раздел 5.2.1
- **Описание**: Добавить поле `GHAStartEpf string \`env:"INPUT_STARTEPF" env-default:""`\``
- **Критерии готовности**: Поле добавлено в структуру InputParams
- **Возможность отката**: Удалить добавленное поле

### 1.3 Расширение конфигурации - Config
- [ ] **Задача**: Добавить поле `StartEpf` в структуру `Config`
- **Приоритет**: Высокий
- **Ссылка на архитектуру**: Раздел 5.2.2
- **Описание**: Добавить поле `StartEpf string \`env:"BR_START_EPF" env-default:""`\``
- **Критерии готовности**: Поле добавлено в структуру Config
- **Возможность отката**: Удалить добавленное поле

### 1.4 Обновление функции MustLoad()
- [ ] **Задача**: Обновить функцию `MustLoad()` для обработки нового параметра
- **Приоритет**: Высокий
- **Ссылка на архитектуру**: Раздел 5.2.3
- **Описание**: Добавить обработку параметра StartEpf в функцию загрузки конфигурации
- **Критерии готовности**: Параметр корректно обрабатывается и передается в Config
- **Возможность отката**: Удалить обработку нового параметра

## Этап 2: Основная реализация

### 2.1 Создание функции ExecuteEpf
- [ ] **Задача**: Создать функцию `ExecuteEpf` в `internal/app/app.go`
- **Приоритет**: Высокий
- **Ссылка на архитектуру**: Раздел 5.4
- **Описание**: Полная реализация функции с алгоритмом:
  1. Валидация входных параметров
  2. Скачивание файла по URL
  3. Сохранение во временный файл
  4. Подготовка параметров для 1cv8
  5. Запуск 1cv8 с параметром /Execute
  6. Обработка результата выполнения
  7. Очистка временных файлов
- **Критерии готовности**: Функция реализована, протестирована локально
- **Возможность отката**: Удалить функцию ExecuteEpf

### 2.2 Интеграция в main.go
- [ ] **Задача**: Добавить case для `ActExecuteEpf` в switch statement
- **Приоритет**: Высокий
- **Ссылка на архитектуру**: Раздел 5.5
- **Описание**: Добавить обработку новой команды в main.go с вызовом `app.ExecuteEpf`
- **Критерии готовности**: Case добавлен, команда корректно обрабатывается
- **Возможность отката**: Удалить добавленный case

## Этап 3: Конфигурация GitHub Actions

### 3.1 Обновление action.yaml
- [ ] **Задача**: Добавить параметр `startEpf` в `action.yaml`
- **Приоритет**: Средний
- **Ссылка на архитектуру**: Раздел 5.3
- **Описание**: Добавить новый input параметр для URL файла внешней обработки
- **Критерии готовности**: Параметр добавлен в action.yaml
- **Возможность отката**: Удалить добавленный параметр

## Этап 4: Тестирование и валидация

### 4.1 Модульные тесты
- [ ] **Задача**: Создать модульные тесты для функции `ExecuteEpf`
- **Приоритет**: Средний
- **Ссылка на архитектуру**: Раздел 8.1
- **Описание**: Тесты для валидации параметров, скачивания файлов, формирования команд 1cv8
- **Критерии готовности**: Покрытие тестами основных сценариев
- **Возможность отката**: Удалить тестовые файлы

### 4.2 Интеграционные тесты
- [ ] **Задача**: Провести интеграционное тестирование с тестовым .epf файлом
- **Приоритет**: Низкий
- **Ссылка на архитектуру**: Раздел 8.2
- **Описание**: Полный цикл выполнения с реальным файлом обработки
- **Критерии готовности**: Успешное выполнение end-to-end теста
- **Возможность отката**: Не требуется (только тестирование)

### 4.3 Финальная валидация
- [ ] **Задача**: Финальная проверка работы основного приложения
- **Приоритет**: Средний
- **Описание**: Убедиться, что существующий функционал не нарушен
- **Критерии готовности**: Все существующие команды работают корректно
- **Возможность отката**: Не требуется (только проверка)

## Этап 5: Поэтапный ввод в эксплуатацию

### 5.1 Тестовое развертывание
- [ ] **Задача**: Развертывание в тестовой среде
- **Описание**: Проверка работы в условиях, близких к продуктивным
- **Критерии готовности**: Успешное выполнение в тестовой среде

### 5.2 Продуктивное развертывание
- [ ] **Задача**: Развертывание в продуктивной среде
- **Описание**: Постепенный ввод новой функциональности
- **Критерии готовности**: Стабильная работа в продуктиве

## Контрольные точки

### Контрольная точка 1: Завершение подготовительных работ
- **Условие**: Выполнены задачи 1.1-1.4
- **Критерий**: Конфигурация расширена, константы добавлены
- **Решение о продолжении**: Переход к этапу 2

### Контрольная точка 2: Завершение основной реализации
- **Условие**: Выполнены задачи 2.1-2.2
- **Критерий**: Функция реализована и интегрирована
- **Решение о продолжении**: Переход к этапу 3

### Контрольная точка 3: Готовность к тестированию
- **Условие**: Выполнена задача 3.1
- **Критерий**: GitHub Actions настроен
- **Решение о продолжении**: Переход к этапу 4

### Контрольная точка 4: Готовность к развертыванию
- **Условие**: Выполнены задачи 4.1-4.3
- **Критерий**: Все тесты пройдены успешно
- **Решение о продолжении**: Переход к этапу 5

## Стратегия отката

### Уровень 1: Откат отдельных изменений
- Каждая задача имеет описанную возможность отката
- Изменения можно откатывать по одному

### Уровень 2: Откат этапа
- Откат всех изменений этапа при критических проблемах
- Возврат к предыдущей контрольной точке

### Уровень 3: Полный откат
- Удаление всех изменений, связанных с execute-epf
- Возврат к исходному состоянию проекта

## Минимизация влияния на существующую кодовую базу

### Принципы безопасной интеграции
1. **Аддитивные изменения**: Только добавление нового кода, без изменения существующего
2. **Изоляция функциональности**: Новая функция не влияет на существующие команды
3. **Использование существующих паттернов**: Следование архитектурным принципам проекта
4. **Постепенная интеграция**: Поэтапное добавление компонентов
5. **Обратная совместимость**: Сохранение работоспособности всех существующих функций

### Области минимального воздействия
- **constants.go**: Добавление одной константы
- **config.go**: Добавление полей в структуры
- **main.go**: Добавление одного case в switch
- **app.go**: Добавление новой функции
- **action.yaml**: Добавление опционального параметра

## Мониторинг прогресса

### Метрики выполнения
- **Общий прогресс**: X/10 задач выполнено
- **Прогресс по этапам**:
  - Этап 1: X/4 задач
  - Этап 2: X/2 задач
  - Этап 3: X/1 задач
  - Этап 4: X/3 задач

### Обновление статуса
Для отметки выполненной задачи замените `[ ]` на `[x]` в соответствующем пункте.

---

**Дата создания плана**: $(date)
**Версия**: 1.0
**Статус**: В разработке