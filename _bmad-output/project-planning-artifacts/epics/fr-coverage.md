# Functional Requirements — Inventory & Coverage

**Проект:** apk-ci v2.0
**Всего FR:** 68 (основная нумерация) + Epic 0 (NEW)
**Покрытие:** 100%

---

## FR Inventory по категориям

### Архитектура и сменные реализации (FR1-FR5)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR1 | Система поддерживает регистрацию реализаций через strategy-интерфейсы | 1 | 1.1 |
| FR2 | Выбор реализации определяется конфигурацией | 1, 4 | 1.6, 4.1 |
| FR3 | Новые реализации добавляются без изменения кода | 1 | 1.1, 1.9 |
| FR4 | Все зависимости внедряются через DI-контейнер | 1 | 1.7 |
| FR5 | Модули имеют чёткие границы и взаимодействуют через интерфейсы | 1 | 1.7 |

### Управление сервисным режимом (FR6-FR9)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR6 | Оператор может включить сервисный режим | 2 | 2.5 |
| FR7 | Оператор может отключить сервисный режим | 2 | 2.7 |
| FR8 | Оператор может проверить статус сервисного режима | 2 | 2.3 |
| FR9 | Система поддерживает принудительное завершение сессий | 2 | 2.6 |

### Операции с базами данных (FR10-FR13)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR10 | Оператор может восстановить БД MSSQL из backup | 3 | 3.2 |
| FR11 | Система автоматически рассчитывает таймаут по размеру бэкапа | 3 | 3.2 |
| FR12 | Оператор может обновить структуру БД по конфигурации | 3 | 3.4 |
| FR13 | Оператор может создать временную локальную БД с расширениями | 3 | 3.5 |

### Синхронизация конфигурации (FR14-FR18)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR14 | Оператор может загрузить конфигурацию из хранилища в БД | 4 | 4.2 |
| FR15 | Оператор может привязать хранилище к БД | 4 | 4.3 |
| FR16 | Система синхронизирует формат EDT из Git в хранилище 1C | 4 | 4.6 |
| FR17 | Оператор может инициализировать хранилища для проекта | 4 | 4.4 |
| FR18 | Система поддерживает выбор инструмента (1cv8/ibcmd/native) | 4 | 4.1 |

### Конвертация форматов (FR19-FR20)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR19 | Система конвертирует между форматами EDT и XML | 4 | 4.5 |
| FR20 | Оператор может выбрать инструмент конвертации через config | 4 | 4.5 |

### Выполнение внешних обработок (FR21)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR21 | Оператор может выполнить внешнюю обработку (.epf) | 4 | 4.7 |

### SonarQube интеграция (FR22-FR25)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR22 | Система сканирует коммиты ветки с фильтрацией | 5 | 5.3 |
| FR23 | Система сканирует pull request | 5 | 5.4 |
| FR24 | Система обновляет метаданные проекта в SonarQube | 5 | 5.6 |
| FR25 | Система генерирует отчёт о качестве для ветки | 5 | 5.5 |

### Gitea интеграция (FR26-FR28)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR26 | Система проверяет конфликты слияния для всех открытых PR | 5 | 5.7 |
| FR27 | Система строит динамическое меню действий | 5 | 5.8 |
| FR28 | Система загружает конфигурацию из репозитория Gitea | 1 | 1.6 |

### Вывод и форматирование (FR29-FR31)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR29 | Система выводит результаты в форматах text/JSON/YAML | 1, 7 | 1.3, 7.10 |
| FR30 | Формат вывода определяется конфигурацией или параметром | 1 | 1.3 |
| FR31 | Данные выводятся в stdout, логи в stderr | 1 | 1.3, 1.4 |

### Логирование (FR32-FR35)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR32 | Система записывает логи в файлы с ротацией | 6 | 6.1 |
| FR33 | Логи записываются в JSON формате | 1 | 1.4 |
| FR34 | Уровень логирования настраивается | 1 | 1.4, 1.6 |
| FR35 | Каждая запись содержит trace_id | 1 | 1.5 |

### Алертинг (FR36-FR40)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR36 | Система отправляет алерты на email | 6 | 6.2 |
| FR37 | Система отправляет алерты в Telegram | 6 | 6.3 |
| FR38 | Система отправляет алерты через webhook | 6 | 6.4 |
| FR39 | Система экспортирует метрики для Prometheus | 6 | 6.5 |
| FR40 | Правила алертинга настраиваются через конфигурацию | 6 | 6.6 |

### Трассировка (FR41-FR43)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR41 | Система отправляет трейсы в OTLP-совместимый бэкенд | 6 | 6.7 |
| FR42 | Каждая операция имеет уникальный trace_id | 1 | 1.5 |
| FR43 | Трейсы включают span-ы для ключевых этапов | 6 | 6.7 |

### Отладка (FR44-FR46)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR44 | Приложение может запускаться в режиме отладки с Delve | 6 | 6.9 |
| FR45 | Поддерживается удалённое подключение к отладчику | 6 | 6.9 |
| FR46 | Отладка работает на Linux (включая Docker) | 6 | 6.9 |

### Миграция и совместимость (FR47-FR50)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR47 | Новые команды имеют префикс NR во время миграции | 1 | 1.1, 1.2 |
| FR48 | Старые команды помечаются @deprecated | 1 | 1.2 |
| FR49 | После полной миграции deprecated-код удаляется | 7 | 7.7 |
| FR50 | Система логирует использование deprecated-команд | 1 | 1.2 |

### Валидация и тестирование миграции (FR51-FR54)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR51 | Shadow-run позволяет сравнивать результаты старой и новой команды | 7 | 7.1 |
| FR52 | Smoke-тесты на реальных конфигурациях после merge | 7 | 7.2 |
| FR53 | Sampling rate для трейсов настраивается | 6 | 6.8 |
| FR54 | Отправка логов/трейсов выполняется асинхронно | 6 | 6.7 |

### Архитектурное управление (FR55-FR56)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR55 | Архитектурные решения документируются в ADR | 7 | 7.8 |
| FR56 | Code review включает проверку соответствия архитектуре | 7 | 7.8 |

### Дополнительные возможности (FR57-FR59)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR57 | Система экспортирует метрики в формате Prometheus | 6 | 6.5 |
| FR58 | Команды поддерживают dry-run режим | 3 | 3.6 |
| FR59 | При восстановлении БД можно маскировать персональные данные | 7 | 7.9 |

### Модель выполнения операций (FR60-FR63)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR60 | Система проверяет состояние инфраструктуры перед операцией | 2 | 2.8 |
| FR61 | Система может автоматически выполнять prerequisite-операции | 3 | 3.4 |
| FR62 | Операции управления состоянием идемпотентны | 2 | 2.8 |
| FR63 | Система показывает план операций (verbose режим) | 7 | 7.3 |

### Миграция и rollback (FR64-FR65)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR64 | Система поддерживает мгновенный rollback | 7 | 7.4 |
| FR65 | Скрипт автоматической миграции пайплайнов | 7 | 7.5 |

### User Experience (FR66-FR68)

| FR | Описание | Epic | Story |
|----|----------|------|-------|
| FR66 | service-mode-status показывает активные сессии | 2 | 2.4 |
| FR67 | Долгие операции показывают progress bar с ETA | 3 | 3.3 |
| FR68 | Каждая команда выводит summary с метриками | 5 | 5.9 |

---

## Coverage Summary по эпикам

| Epic | Название | FRs | Кол-во |
|------|----------|-----|--------|
| 0 | Extension Publish | NEW | — |
| 1 | Architectural Foundation | FR1-5, FR28-35, FR42, FR47-48, FR50 | 16 |
| 2 | Service Mode Management | FR6-9, FR60, FR62, FR66 | 7 |
| 3 | Database Operations | FR10-13, FR58, FR61, FR67 | 7 |
| 4 | Configuration Sync | FR14-21 | 8 |
| 5 | Quality & Integration | FR22-27, FR68 | 7 |
| 6 | Advanced Observability | FR32, FR36-41, FR43-46, FR53-54, FR57 | 14 |
| 7 | Finalization | FR29 (YAML), FR49, FR51-52, FR55-56, FR59, FR63-65 | 9 |

**Итого: 68 FR → 8 эпиков (включая Epic 0)**

---

## Связанные документы

- [Epic Overview](./index.md)
- [PRD](../prd.md)

---

_Последнее обновление: 2025-11-25_
